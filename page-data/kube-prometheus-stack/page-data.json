{"componentChunkName":"component---src-templates-post-template-jsx","path":"/kube-prometheus-stack","result":{"data":{"markdownRemark":{"html":"<h1 id=\"들어가며\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가며</h1>\n<p>사내에서 EFK-Stack(ElasticSearch+Fluent-bit+Kibana)를 이용하여 모니터링 시스템을 구축했었습니다. 하지만 AWS Opensearch를 이용하다보니 비용적인 문제와 비교적 활용도가 낮았던 fluent-bit(응답이 길면 Probe가 자꾸 문제가 발생), metirc 데이터 필요, 쿠버네티스에 맞지 않은 설정들등 다양한 이슈로 모니터링 시스템을 바꿔야 하는 요구 사항이 생겼습니다. 그러던 중 쿠버네티스 모니터링 시스템계의 또 하나의 터줏대감인 Prometheus, Loki, Grafana를 이용하여 새롭게 모니터링 시스템을 구축하였습니다.</p>\n<blockquote>\n<p>💡 개념적인 내용은 공식 문서와 ChatGPT를 참고하여 작성하였습니다.</p>\n</blockquote>\n<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<div style=\"width:100%\">\n<p><img src=\"/b476e79d8d7827d58677e505521e4550/overview.gif\" alt=\"overview\"></p>\n</div>\n<h1 id=\"prometheus\" style=\"position:relative;\"><a href=\"#prometheus\" aria-label=\"prometheus permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.303030303030305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVQoz41QTUsCURT1pwT9kKAfELVskZuCqFWgQdi+NtGuFq3FNq3SJNzkR00uNJjM/Br8GMURGaNs5r07b+Y9u44mEqReHhfuO++8c+7xDP4vpjXxzHjg+XshxLBZVDs7Uv3e2u6adn4sgEygmWTuYNODF8XVZVrKmS9SYWUJRxfi88huqf6txsGmq8br+xvqoXcx2+737RNfK7ANyjtU8s3ATvvUt4AybuXahloZt0W3evCytrcODWWy0fDN7/JjMiYkmDWdmd3rGpmUkXlkbXVO2uTpniTCTMmzetGuFuA1bTfKTqfJSjJ9joEs2a0qq+ScXpcpb47eGWmMyZBNIYZ8KsWM6DVkk+Th9vvmiiQiJHkHmbgRDZF4mCQjZjRkyekpMvpkDINF5/zrQwAdMMDOzb6wgPc/B44tiCkoQRRHQYyR5A/WuCl/nPIGmAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prometheus\"\n        title=\"prometheus\"\n        src=\"/static/a740d1b72f8e98e60002294fa2d3f7fa/7c811/prometheus-logo.png\"\n        srcset=\"/static/a740d1b72f8e98e60002294fa2d3f7fa/103f2/prometheus-logo.png 165w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/748ba/prometheus-logo.png 330w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/7c811/prometheus-logo.png 660w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/d28e0/prometheus-logo.png 990w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/64756/prometheus-logo.png 1200w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"prometheus란\" style=\"position:relative;\"><a href=\"#prometheus%EB%9E%80\" aria-label=\"prometheus란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus란?</h2>\n<p>Prometheus는 SoundCloud에서 처음 개발된 오픈 소스 시스템 모니터링 및 알림 툴킷입니다. 2012년에 시작된 이후로 많은 회사와 조직이 Prometheus를 채택하였고, 매우 활발한 개발자와 사용자 커뮤니티를 가지고 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.87878787878788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACw0lEQVQ4y4VU247TMBDt///F8hdICAmhIh4AqQV2td229JombeMmdi6+JDnMTJuyZVlhaZSJPTM+Zy4eeB/QBA/jWsw3O0yfJsi1hnMOVVWhKAoYY65fow00nTdtg/z9HNnbKUxh4L1HoFgDduSfqqqhlLpKmqbytdZKcGudfHvhfaNymDRHaQqJwfuDtm3RAYJms9lgtVphsVggiiIcDgcxhFgAbMvC/54uyA4KWaqgTzm6rpOzQdM0YOEN9EKLES6XS9FtTc7K0FErttZ5tKSzT1cE+XIK+OwakFcerRDPJ6J/Gg5xd/dG9ENywsN4Jbo2FVaRAvOqsxrJ1x2C9YLuGlB+SFR6xD6O5KAqC2QnJfsFJT3PM4QQSK8oFUpS4QnpSWXgwt4EFMrs6BqoKhDtFqUL0JUXvao9aqLNTs47aKo4654uMLW9BmPaEjBcKP9YJvj485y32U5hNNmcKWcOCaHipbIU48n9eV+XeEf2lhB2fyPkW/ZJjDjaUsIpP1R1nWVCmenr/EToqDW4XU4X+mWJeH8k9PYlZd4IoRHDru1QuRLGllL12jZI9Zm+54buvCBiyhlf2tdBAl4UQZgWRKkUOmt1xIh6kddmX2D4/Sj9l9cVxkkkAUti8WU0FhC3CKVhG5mG2jrRW64c0eOuLHSOI1ef7GxdU0On4sxpMTSGPDXXgG0fMN2jWU4RHkcgb6Q2YK1roVzSrMe25lGBbyh3TSkIGZm5VPyWMjm01Gc2XqN4+EZzaPB4zPHhVyKUI+rHz/OZ5DAnhPfxUi7i+Z/OZq9QTraw1MCWqtnt1iiJuqahbxgRvTKK5lrGjujlNLvhohtzfpleUqaG9U8z6MUSLd+YbRG2D2hkvG8fh/4heK73hf1TZX4EFltkyVEK4U8J7HYi+4yyb6/X5J996Ki63LyccEdzWj+rXm/zP/kNxmRzs8mmvEAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CNCF\"\n        title=\"CNCF\"\n        src=\"/static/8755941b5003f2471579539608ddb03d/7c811/CNCF.png\"\n        srcset=\"/static/8755941b5003f2471579539608ddb03d/103f2/CNCF.png 165w,\n/static/8755941b5003f2471579539608ddb03d/748ba/CNCF.png 330w,\n/static/8755941b5003f2471579539608ddb03d/7c811/CNCF.png 660w,\n/static/8755941b5003f2471579539608ddb03d/d28e0/CNCF.png 990w,\n/static/8755941b5003f2471579539608ddb03d/70841/CNCF.png 1094w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Prometheus는 2016년 Kubernetes 에 이어 두 번째 프로젝트로 Cloud Native Computing Foundation에 합류했으며, 서비스 운영을 위해 모니터링 시스템을 구축할 때 가장 널리 사용되는 툴 중 하나입니다.</p>\n<h2 id=\"특징\" style=\"position:relative;\"><a href=\"#%ED%8A%B9%EC%A7%95\" aria-label=\"특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>특징</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQoz11RCY7EIAzr/186qx2OFiiUK2unZTTaqEjEdRLHbDKn9Fql9y6tNRljivSGrynGw5hfGHlzDOkp6r1r3VDeNpEEa8Q5L9ZaybnIuIp4Yv7GKgbWeIhH7pxTrNVL0u8LnF2x8zzvhpzoHuK+75JSknJdWnwcd5NSihaw0eJxSIjpMyTG+CjEyhca8PBOCxqGrBWI8XA1cth82RDQJOeszVf9NiE9e6s/AxR1eDjPKGmHwhBUMYM2JHAicmIVeXn/aM66xdtoqMcq9jm6MtbzzooxRleiuhP4WjlgEBUd/vbTGqO4KqR8EsKjplIxHoaPRIx+LQ/ZnF7xzjpuQJ/JI06btuWR+vcEf1DB8pFBlTzfQe/+1/8B+DNu8UK0ozsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prometheus-point\"\n        title=\"prometheus-point\"\n        src=\"/static/501a3b0a5df3b550e5e082e669268e37/7c811/prometheus-point.png\"\n        srcset=\"/static/501a3b0a5df3b550e5e082e669268e37/103f2/prometheus-point.png 165w,\n/static/501a3b0a5df3b550e5e082e669268e37/748ba/prometheus-point.png 330w,\n/static/501a3b0a5df3b550e5e082e669268e37/7c811/prometheus-point.png 660w,\n/static/501a3b0a5df3b550e5e082e669268e37/d28e0/prometheus-point.png 990w,\n/static/501a3b0a5df3b550e5e082e669268e37/74b07/prometheus-point.png 1238w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li><strong>다차원 데이터 모델</strong>: 메트릭 이름과 키/값 쌍으로 시계열 데이터를 식별합니다.</li>\n<li><strong>PromQL</strong>: 이러한 차원성을 활용할 수 있는 유연한 쿼리 언어입니다.</li>\n<li><strong>분산 저장에 의존하지 않음</strong>: 단일 서버 노드가 자립적으로 작동합니다.</li>\n<li><strong>HTTP를 통한 풀 모델</strong>: 시계열 데이터 수집이 HTTP를 통해 이루어집니다.</li>\n<li><strong>서비스 발견 또는 정적 구성을 통한 타겟 발견</strong>: 다양한 그래핑 및 대시보드 지원 모드가 있습니다.</li>\n</ul>\n<p>위처럼 여러 특징이 있지만 주요 특징은 2가지로 요약됩니다.</p>\n<p><strong>Pull-Based Monitoring</strong></p>\n<p>기존의 Push-Based Monitoring 방식 대신에 Pull-Based Monitoring을 사용합니다. 대상 서버에 설치된 Exporter가 메트릭 정보를 수집하고, 이 데이터는 수집 서버가 주기적으로 가져가는 구조입니다. </p>\n<p>즉, 클라이언트에서 서버로 데이터를 보내는 것(PUSH)가 아닌 서버가 클라이언트의 데이터를 수집(Pull) 방식입니다. 이러한 방식은 기존의 에이전트(agent) 방식보다 더 유연하고 관리하기 쉽습니다.</p>\n<p><strong>시계열 데이터베이스(TSDB)</strong></p>\n<p>관계형 데이터베이스(RDB) 대신 메트릭 이름과 key-value 쌍으로 식별되는 시계열 데이터 모델을 사용합니다. 이를 통해 대량의 정보를 빠르게 검색할 수 있습니다.</p>\n<h2 id=\"architecture\" style=\"position:relative;\"><a href=\"#architecture\" aria-label=\"architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADaElEQVQozz2SS2wbVRiFLzh1EtpFkWjJhgU7aHdRQAhCSpEQj6oLloQNQoiwIRVKpQgh2V2kUV8gyoIdLYkIIg2icpKaOICJmzpuHKexa7t+zTPz8oztuZ6XZ8bj0WXsphzpW9xfV0fn3P8CURRzLMtCUayyvCifhKoV1gwTcULVphnWIUja0XTD1s02qmvuMEIIeHrOw4+Xs6BAl1/N1Eu/FyEZxiX6IyBDOM1xfLzRkBcU3XiRlYzEPldDNE0hCJtIliFiGAY1oIokXnrbFujZGlaMQApbc4jCcIkhh8kak2PqHC5AcRJ8DYAvl81ezKeSJ+qqAkq0NJbOFX8uV5X3WR2N7ivOqTIHT5VYOEbupIachph0GpLm1Ku6TJQ+oxluTJGbe7AhVwzdOAfa9WrFI99uSKxJVz5wZPFLyFBpC89ft7HsFZt4dK3DU1eQof7QKuy+1K38hDvzPx310n+oqMquoiiEoqrngM3TYYOuRFyR/cMlH73escyca1uoLdeQ3ZBQG9aRo6vIdV1kMsRZniTA5ubmN4lkaiQe2+gZT50/f2h8fLwvGAw+DZwaDxCZB/e2k1/sbMZOt5ryXUXTkG5attYyHcO0nLosW4rSRMY+/i5FUuDv9fWR9bXIUNeMrxR9geAFMDExAaampgAoZfb88fDyQGp3d/xh4t4rLQUmFEVFhqG7TQiRpqlI142OaduIz+2d8bb7jEffdtRLV0wDi6JAvpQBwcAFEFpdBcAwjF7sXPoBGOm+jW3tocdqe3S6uBJnm7FVpHPUewffps9mqYttlixaLH3tYAYWv70EAI7jHxME8ck+w5xduH71cCWb+UegKbWQSQs/fv+d+Ff4jihgJZ5ObemZrbtvEYV8L0CLL8838AJqCditaB2Bk6+909dzhV4tSZK8ahrCMPzEvxsbf2IYpsdisero6JvSzMyMxHK8UCEpYy0SOf3/ljvSL6aQRcit3fJsjvh8/uH+/kNHQSgUejkQCJyZm5t7w7voD92+/aw3G0qldo575x6Lvy4cDy3+9vz8zRv+ycmvnuoa1oTizSZ3HzVrlQXPcHBw8PALAwP9R8BB/2MevunpaRCNRsHKygqIx+OPq7VaYGlpCSwvL4PZ2Vlw+fKlnmF86/6n26mHN7YSyc/T6R3wRP8Bv6Khni6cOA0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prometheus-architecture\"\n        title=\"prometheus-architecture\"\n        src=\"/static/2ada1ece66fcc81d704c2ba46f9dd7d3/7c811/architecture.png\"\n        srcset=\"/static/2ada1ece66fcc81d704c2ba46f9dd7d3/103f2/architecture.png 165w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/748ba/architecture.png 330w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/7c811/architecture.png 660w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/d28e0/architecture.png 990w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/bb51b/architecture.png 1320w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/f631a/architecture.png 1351w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><strong>Exporter</strong></p>\n<ul>\n<li>host서버에 설치되어 메트릭 데이터를 수집하는 역할을 합니다.</li>\n<li>Prometheus 서버가 접근하여 데이터를 가져올 수 있는 HTTP 엔드포인트를 제공하여 다양한 데이터를 수집합니다.</li>\n</ul>\n<p><strong>Prometheus Server</strong></p>\n<ul>\n<li>Prometheus Server는 메트릭 데이터를 스크랩하고 저장합니다.</li>\n<li>메트릭 데이터 수집 주기를 설정하여 지정된 시간마다 대상 서버에 있는 Exporter로부터 데이터를 수집합니다.</li>\n<li>수집한 데이터를 저장하고 PromQL(프로메테우스 쿼리 언어)를 사용하여 데이터를 쿼리하고 필터링할 수 있습니다.</li>\n</ul>\n<p><strong>Grafana</strong></p>\n<ul>\n<li>Grafana는 데이터 시각화 도구로, Prometheus가 수집한 메트릭 데이터를 그래프나 대시보드 형태로 시각화하여 표현할 수 있습니다.</li>\n<li>Prometheus Server에서 직접 제공하는 웹 뷰보다 더 다양한 시각화 기능을 제공하며, Grafana를 통해 데이터를 더 직관적으로 이해할 수 있습니다.</li>\n</ul>\n<p><strong>Alertmanager</strong></p>\n<ul>\n<li>Prometheus가 수집한 메트릭 데이터를 기반으로 경고를 생성하고 규칙을 만들어 관리합니다.</li>\n</ul>\n<p>이렇듯 Prometheus로 metric 데이터를 수집하려고 했지만 Docker형태나 pod 형태로 배포하기엔 따로 작업을 해야해서 다른 방안이 없나하고 찾아보던 중 Prometheus, Grafana, Alertmanager 등을 함께 묶어 kubernetes 환경에 맞게 Helm 차트 형태로 설치할 수 있는 kube-prometheus-stack을 발견했습니다..!</p>\n<h1 id=\"kube-prometheus-stack\" style=\"position:relative;\"><a href=\"#kube-prometheus-stack\" aria-label=\"kube prometheus stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kube-prometheus-stack</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE2ElEQVQ4y1VUa2wUVRS+bC0hETEYRJNKq1Ai3d2Z2QWKNippRNNIJNY2adMuGuhju519tcEK1pj4o8qjGNAKjfCDGAwWE/1hmgjKQ8FgTSnFCkILZbdzZ6aP7bvdNm1393jO3ZrgJCdz5977ffPd75x7GHvokaofsE3vTbANuzqZ7O1bIvuMpbJPZ7KPu2Uv9+A3jo1UWe1jTrWbSf4hJqth9r9H8vQye1UPEmhLFB8XY8VvpkjVvUzycuYMDrCNQeMMRguNaY4wSJwiVd3FvbrA2tzdzO65n1Rl99wjRbjYb3EEI0uQEEE9j6KqEoffaFpXwXlmBdedAeMLJCySqrqXkVolMGjBtwX3MZu7B3l6ibCXCC0o/RklMMAocMMuxWcMIhlsqNIhcGI0Ud08Nr/erYMjYACSmGhDKQpgks8khRlIaFkkDBHhCvSqH6MB4xACQPEbZs4eXWVseDlMD50C7c5UbStkrS8LvYs/MmgP7v00GcaA3d29gk7LZPyLLP7CX8CFGdlvAqr7DQCYq3mOXb3czWYNzT9xthlgfrLm/eMawyXE6JfRGlIbRYXZyeQZjIiEBziZiRMTtEnyGtO5e426BYAtANMsnkhUDu/3Q/T3nzqYH5au2x2qQ5WzSZXGuMAKDm7BRAxYFKFSP0EbNgW1UkxAZ3HjCMTMMCxMjr25EIs3DHjyYPrM5xM/3oO2rXU6WKuNdodfK108+ldJ/wdTRFJs5V2p5ANGZ3r5IGOOc6tePTB3kX/fArFbf/TPtP86yHNXw2TLsXhibAg+OW1eYOz2SpZnMrTnL+Fh5e3UpIdejYrz2cU/HV1bYbCd3wC7C5ARaTk5P/pxOQwF80HfvjY+9W1TfPyHU2gv5NR/N8dW7TTpZEcJi8l9jkqPbgFNpguDvbwxb19P2hPFob1fX5m7NtvoBe21NXEj3xo3i5ww9FFZYubLvXDs57m2lUUP9r1R/yANsQcWsRnkI1O8oeWocudiqcwoXh3swQhcOn8HJlxKgr9lA7NQAuNtKxjFm2HU5Ux0XWyHLftGQVK5wIjTeXkZ2vc4pboHo49KBhdjVnfoSO5h8IxcaOX9hXYkssfNAntCRKGc4NvSIHq6cX7/Fahf47r3IRZ6TJSbTw/h+z4d2UE1R0WNhGAru5NtfeUsm+q41mEWb0RCW8wskEAQFjkTel4GjJw9ST4ueyzv+ka6TYg9mPMZUD7sTBQkdg9MzFOYsSje1yHGSlIR4I4croPw1icX9HxbXEcf+15Pn9ffeRmAd51/+gisxmMOo4g5xKYJDkwwFSO1qUdEa/LyQlKJ3vz90iHIgig/M3PQA5ESJ0Rcm2F6zw6A9lb9dDt4M8u1m46ASIYLMUxwYMsTzSBzWwO9LdRlUPFuB2bN5uETOR+MHD93Y/aX8J+d/4TbOm5duD7eWdIUvbi+ko8LMp+u0tWlrmMvv8GUYAQVqiEmYQ+UKm/RvU4hpZKqbSdSSdVhbTkHqWYYpNphwBqFDW4ORIZtrADvPQnBvojNtvo+4kLJJiuK26cRoSXZLPQjSHx1UyD8fHaQBxRVOySrWuPmIK99sbbPiuuXcP2EuG6E8fGkfw8/VOWOmrFkP/TxJvQmnxKGjYJZ1X6WhUHjJJhvo/sr+weZw31TzP33/AtUCCX8YSO2NwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kps\"\n        title=\"kps\"\n        src=\"/static/6b270f686608d58dc036437bdf92f868/d9f49/kube-prometheus-stack.png\"\n        srcset=\"/static/6b270f686608d58dc036437bdf92f868/103f2/kube-prometheus-stack.png 165w,\n/static/6b270f686608d58dc036437bdf92f868/748ba/kube-prometheus-stack.png 330w,\n/static/6b270f686608d58dc036437bdf92f868/d9f49/kube-prometheus-stack.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"kube-prometheus-stack이란\" style=\"position:relative;\"><a href=\"#kube-prometheus-stack%EC%9D%B4%EB%9E%80\" aria-label=\"kube prometheus stack이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kube-Prometheus-Stack이란?</h2>\n<p>kube-prometheus-stack은 kubernetes cluster에 맞게 구성된 오픈 소스 프로젝트입니다. Prometheus를 기반으로 하며, 쿠버네티스 클러스터의 다양한 컴포넌트들의 메트릭 데이터를 수집하고 이를 시계열 데이터로 생성하여 모니터링 및 경고 기능을 제공합니다.</p>\n<p>즉, 쿠버네티스 클러스터만 있다면 간단하게 helm chart로 설치가 가능합니다!</p>\n<p>github : <a href=\"https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack\">https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack</a></p>\n<h2 id=\"architecture-1\" style=\"position:relative;\"><a href=\"#architecture-1\" aria-label=\"architecture 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.36363636363636%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACA0lEQVQoz11RyW7UQBD15/IJXOELgBM3JARHEqRIgIYLkQIBJUw0ISgTe+K9vbQ97s29ud1uehAHoPRUh6p6VfWqAtqANo5gDVDXaq2cc3perLPnW/lihUsApBTGLjXVDZZhXGRlI/SMR8nlFHS7LQxva+5KiKMG13FCdmEvLBqlUJOaTDvQDrGWqhbLOfqMqyTOSsoFE1MQ3ecfvtxmLS7bAXNZ3d11Py5HKV+f149OknWK2qoYCBtGLbVh+4IQ1PZ4IH6wCZIcXkVUzUs9jKAnMYDh7p5S9uZ7+/RjdlPSaXGsG5qeWa9oOYgy1ns7zzaAAFxf3cSgLzuCMDmL0MOj5PkpeLLKHp8kz1bpg1fhyWnIuUwb0q+O6zzfJVlWAAb3QRRl93dpT0Ta0gKiywS9PCveXcP3G3j0rfy03b/ddNc3hRAKSUOAVysR4wMTqu2CCjRXMdzWpNozRpnf3x0urhwfl76bpXLWLHXlisKNzM2zk9IZc6gZhsAozsaRUDYJ5owX5ezirJBO634T5l9/uu3WXlws6/Wy2bg0dVXlIHQIH8jOHUZZa/0Ddkle1nCUE/PQM6UCd3ikjBYVjWJ/NkY5U4ZJzYSmXAfutwltOsKzsoJ77Jk17OO0IFxV3ZAUIG/gnvIUND7tg3nV+IIWjX/IdlmEMr7F/1DTP9DT36lfirtef5yNx0QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kps-architecture\"\n        title=\"kps-architecture\"\n        src=\"/static/ec9145e6291d38ca2d6b4a310a081b2a/7c811/architecture-kube-prometheus.png\"\n        srcset=\"/static/ec9145e6291d38ca2d6b4a310a081b2a/103f2/architecture-kube-prometheus.png 165w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/748ba/architecture-kube-prometheus.png 330w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/7c811/architecture-kube-prometheus.png 660w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/d28e0/architecture-kube-prometheus.png 990w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/bbbf7/architecture-kube-prometheus.png 1280w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><strong>Prometheus Operator</strong></p>\n<ul>\n<li>쿠버네티스 내에서 Prometheus 서버와 관련된 리소스들을 관리하기 위한 컨트롤러입니다.</li>\n<li>Prometheus와 관련된 설정, 서비스 디스커버리, 룰 및 대시보드를 관리할 수 있습니다.</li>\n</ul>\n<p><strong>Prometheus Server</strong></p>\n<ul>\n<li>고가용성을 제공하는 Prometheus 서버입니다.</li>\n<li>메트릭 데이터를 스크랩하고 저장합니다.</li>\n</ul>\n<p><strong>Alertmanager</strong></p>\n<ul>\n<li>Prometheus가 수집한 메트릭 데이터를 기반으로 경고를 생성하고 관리하는 역할을 합니다.</li>\n</ul>\n<p><strong>Prometheus node-exporter</strong></p>\n<ul>\n<li>node-exporter는 Host의 metric을 수집하는 역할을 합니다.</li>\n<li>CPU, 메모리, 디스크 사용량 등의 데이터를 수집하여 Prometheus로 전달합니다.</li>\n</ul>\n<p><strong>Prometheus Adapter for Kubernetes Metrics APIs</strong></p>\n<ul>\n<li>쿠버네티스의 메트릭 API와 연동하여 클러스터 내부의 리소스 메트릭 데이터를 수집하고 Prometheus로 전달합니다.</li>\n</ul>\n<p><strong>kube-state-metrics</strong></p>\n<ul>\n<li>쿠버네티스 클러스터의 상태 정보를 메트릭으로 수집합니다.</li>\n<li>파드, 디플로이먼트, 노드 등의 상태 정보를 모니터링할 수 있습니다.</li>\n</ul>\n<p><strong>Grafana</strong></p>\n<ul>\n<li>Grafana는 데이터 시각화 및 대시보드 생성 도구로, 수집한 메트릭 데이터를 그래프나 대시보드 형태로 시각화하여 사용자에게 제공합니다.</li>\n</ul>\n<h2 id=\"구성\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%EC%84%B1\" aria-label=\"구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구성</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 268px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.36363636363636%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBklEQVQ4y52V147CMBBFQw2h9947hCaQkJD4/9+a1RlpIvYBcHgY2QT75pax49VqNfF9X0qlkoxGI+n3+1rNZlOGw6GO9XpdcrmceJ73vdrttgLO53N5PB5yOBzkeDxKGIZyPp8VdDweS6FQcAPsdrtSLBaV3Xq9Fl7A5t1uJ51Oxw3ktXq9nlQqFQW8Xq/KCkb3+12wg0WJRMId0CRPp1O53W7yfD5VJpXNZuMzRFY+n1fzF4uFBkIIsYGsbDPyGo2GVKtV2W63yjiZTP4OCJC1DokTEGnDHg/T6bRkMhkdU6mUGyDhYMHpdIqAV6uVzkl9NpsJIU4mk/dhGSBy8ZENm81GLpeLMgSI1AG2DmC05yj5B2ytQS+Wy2UZDAYaDhvwEiCewQ7GsGc01sxZj7ooZRoZhiyGFUCcFGsbwqHwjmIOKzy1ecQQmUyQzhwJNDWAtBBpE8RPbUMwpGopI4nnyEN2LEA8wEfONqzwhWDwDsaAOh1DAzTJAOIjrbHf75VtZHhcyRQh0TawhB0B0R4UliyXy4jtV8mkbY2LhwDzLAiC6H9e+vFufJVM62A+LEiZNuI3RzK2ZAOkVWhmu7UpQPGWK40R+W+vNjspyGARHuIbhVfI5wX85oWs5w59e0GQLEAYTqsQBEUPwhL/AGJ0kszXDEB8arVaGgpskUa9Lnb5FPwBCncXDHMb1dUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kps-chart\"\n        title=\"kps-chart\"\n        src=\"/static/6e3dd2ffffd6c38801fee546e6edc792/baf7c/kps-helm.png\"\n        srcset=\"/static/6e3dd2ffffd6c38801fee546e6edc792/103f2/kps-helm.png 165w,\n/static/6e3dd2ffffd6c38801fee546e6edc792/baf7c/kps-helm.png 268w\"\n        sizes=\"(max-width: 268px) 100vw, 268px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>kube-prometheus-stack을 포함한 대부분의 Helm 배포 패키지는 비슷한 구성으로 이루어져있습니다.</p>\n<p><strong>charts</strong> </p>\n<ul>\n<li>Helm 차트의 종속 차트를 포함하는 위치입니다.</li>\n<li>이 패키지의 경우 grafana, kube-state-metrics, prometheus-node-exporter가 존재합니다.</li>\n</ul>\n<p><strong>templates</strong></p>\n<ul>\n<li>Helm 차트의 템플릿 파일들을 포함합니다.</li>\n<li>템플릿은 Kubernetes 리소스의 정의를 작성하는 데 사용되며, 애플리케이션의 배포, 서비스, 구성 등을 관리할 수 있습니다</li>\n</ul>\n<p><strong>crds</strong> </p>\n<ul>\n<li>Custom Resource Definitions(CRDs) 파일을 포함할 수 있는 위치입니다.</li>\n<li>Kubernetes API에 사용자 정의 리소스와 그에 대한 스키마를 추가하는 데 사용됩니다.</li>\n</ul>\n<p><strong>Chart.yaml</strong> </p>\n<ul>\n<li>Helm 차트의 메타 정보를 정의합니다.</li>\n<li>메타 정보에는 차트의 이름, 버전, 유형, 유지 보수자 정보 등이 포함됩니다.</li>\n<li>종속 차트, 애플리케이션의 버전 제약 조건 등을 지정할 수도 있습니다.</li>\n</ul>\n<p><strong>values.yaml</strong></p>\n<ul>\n<li>Helm 차트의 기본 구성 값을 정의합니다.</li>\n<li>애플리케이션의 설정 옵션, 환경 변수, 리소스 크기 등을 설정할 수 있습니다.</li>\n<li><code class=\"language-text\">values.yaml</code> 파일에 정의된 값은 템플릿 파일 내에서 사용될 수 있으며, 차트를 배포할 때 사용자 지정 값으로 수정하여 배포할 수도 있습니다.</li>\n</ul>\n<h2 id=\"설치하기\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\" aria-label=\"설치하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치하기</h2>\n<h3 id=\"create-namespace\" style=\"position:relative;\"><a href=\"#create-namespace\" aria-label=\"create namespace permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>create namespace</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl create namsespace monitoring</code></pre></div>\n<p>먼저 KPS을 설치할 네임스페이스를 생성합니다.</p>\n<h3 id=\"add-helm-repo\" style=\"position:relative;\"><a href=\"#add-helm-repo\" aria-label=\"add helm repo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add Helm repo</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 헬름 차트의 저장소 추가</span>\n$ helm repo <span class=\"token function\">add</span> prometheus-community https://prometheus-community.github.io/\n$ helm repo update</code></pre></div>\n<p>Helm을 통해 prometheus-community repo를 cluster에 받아옵니다.</p>\n<h3 id=\"pull-helm-config-file\" style=\"position:relative;\"><a href=\"#pull-helm-config-file\" aria-label=\"pull helm config file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pull helm config file</h3>\n<p>몇가지 커스텀을 해야하기 때문에 config에 대한 값을 수정할 수 있는 manifast file을 다운로드 한 후 압축을 풀어줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ helm pull prometheus-community/kube-prometheus-stack\n$ <span class=\"token function\">tar</span> xvfz kube-prometheus-stack-<span class=\"token variable\">${version}</span>.tgz <span class=\"token comment\">#설치된 버전을 작성하시면 됩니다!</span></code></pre></div>\n<h3 id=\"service-수정\" style=\"position:relative;\"><a href=\"#service-%EC%88%98%EC%A0%95\" aria-label=\"service 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>service 수정</h3>\n<p>대시보드 형태로 외부에서 접근할 수 있게 <code class=\"language-text\">prometheus-grafana</code>만 clusterIP에서 LoadBalancer나 NodePort로 변경합니다. (이 글에선 loadbalancer로 설정하였습니다)</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">grafana</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\t<span class=\"token punctuation\">...</span>\n\t<span class=\"token comment\">## Passed to grafana subchart and used by servicemonitor below</span>\n  <span class=\"token comment\">##</span>\n  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer\n    <span class=\"token key atrule\">portName</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>web\n<span class=\"token punctuation\">...</span></code></pre></div>\n<p>그 후 수정된 values.yaml 파일을 paramater로 주어 helm chart를 배포합니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ helm <span class=\"token function\">install</span> prometheus <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-n</span> monitoring <span class=\"token parameter variable\">-f</span> values.yaml</code></pre></div>\n<h3 id=\"service-확인\" style=\"position:relative;\"><a href=\"#service-%ED%99%95%EC%9D%B8\" aria-label=\"service 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>service 확인</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get svc <span class=\"token parameter variable\">-n</span> mornitoring</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 511px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVQY0y2OS0+DQBRGP2gpDC02JH3ZFwxQwCY2Lpt2qS6aNLo0/v8fcrxGFyd3ZpI59yjwHj0d0e9sGlTXaL1GsxnKczSfo+USpRnKhHqjNR5EGjiKuKCMS6rEMwnHKNhsUFmaZIv2/m+2PapMXtj90Nl7gQYJmgRoF6KtMQhwYULhtni3p0k906EtVdui5xers0/d3gQ7EyzQamqVExRbTWTIGP/X1UYgIqWsVJFpRa4NQ1mh8wdcv2PUvhL1X0Snb8bdp5XecPXdzh8k6zcTnxk+XhkdL4TdhdH8zKlfcD8veL9m3K45xybmBy1rYuGjdKHCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"promehteus-service\"\n        title=\"promehteus-service\"\n        src=\"/static/af33bfb74fe139bbca28585779045e35/40f84/prometheus-service.png\"\n        srcset=\"/static/af33bfb74fe139bbca28585779045e35/103f2/prometheus-service.png 165w,\n/static/af33bfb74fe139bbca28585779045e35/748ba/prometheus-service.png 330w,\n/static/af33bfb74fe139bbca28585779045e35/40f84/prometheus-service.png 511w\"\n        sizes=\"(max-width: 511px) 100vw, 511px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>배포되어있는 service를 확인해보면 정상적으로 prometheus-grafana의 servive type이 LoadBalancer로 설정되어 배포된 것을 확인할 수 있고, <code class=\"language-text\">EXTERNAL-IP</code> 에 명시된 외부 IP 주소로 접근하실 수 있습니다. </p>\n<p>(후에 AWS Route53와 같은 DNS service를 통해 해당 주소를 routing 해주시면 좋습니다!)</p>\n<p>자! metric data 수집과 모니터링 구축은 완료했습니다. 이제 log를 수집해보겠습니다.</p>\n<h1 id=\"loki-stack\" style=\"position:relative;\"><a href=\"#loki-stack\" aria-label=\"loki stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki-Stack</h1>\n<h2 id=\"loki-stack이란\" style=\"position:relative;\"><a href=\"#loki-stack%EC%9D%B4%EB%9E%80\" aria-label=\"loki stack이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki-stack이란?</h2>\n<p>Loki-Stack은 Loki 로깅 엔진을 포함하지만, 추가적으로 로그를 수집, 집계, 시각화하기 위한 다른 컴포넌트들도 함께 제공합니다. </p>\n<ul>\n<li><strong>Loki</strong>: 로그 데이터를 저장하고 쿼리합니다.</li>\n<li><strong>Promtail</strong>: 로그 데이터를 수집하고 Loki로 전송합니다.</li>\n<li><strong>Grafana</strong>: 로그 데이터를 시각화합니다.</li>\n</ul>\n<h3 id=\"loki-vs-loki-stack\" style=\"position:relative;\"><a href=\"#loki-vs-loki-stack\" aria-label=\"loki vs loki stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki VS Loki-Stack</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>구성 요소</th>\n<th>기능 범위</th>\n<th>용도</th>\n<th>설치 및 관리</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>loki</td>\n<td>로깅 엔진</td>\n<td>로그 저장 및 쿼리에 중점</td>\n<td>다른 로깅 시스템이나 시각화 도구와 통합</td>\n<td>단일 컴포넌트로 더 간단하게 설치 및 관리</td>\n</tr>\n<tr>\n<td>loki-stack</td>\n<td>로깅 엔진, 로그 수집기, 시각화 도구까지 포함</td>\n<td>로그 수집부터 저장, 쿼리, 시각화까지 전체 로깅 파이프라인 제공</td>\n<td>독립적인, 통합된 로깅 솔류션을 제공</td>\n<td>여러 컴포넌트를 관리해야하므로 설정과 관리 복잡</td>\n</tr>\n</tbody>\n</table>\n<p>loki만이 아니라 promtail과 여러 컴포넌트를 쉽게 사용할 수 있는 loki-stack을 선택해서 배포하도록 하겠습니다. </p>\n<h2 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/grafana/helm-charts</code></pre></div>\n<p>위의 명령어로 helm chart를 받아옵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> helm-charts/charts/loki-stack</code></pre></div>\n<p>grafana/helm-chart 레포지토리를 clone하여 받아온 후 loki-stack 디렉토리로 이동합니다.</p>\n<p><strong>디렉토리 구조</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./                                \n├── Chart.yaml                    \n├── README.md                     \n├── charts                        \n│   ├── filebeat-7.17.3.tgz       \n│   ├── fluent-bit-2.6.0.tgz      \n│   ├── grafana-6.43.5.tgz        \n│   ├── logstash-7.17.3.tgz       \n│   ├── loki-2.16.0.tgz           \n│   ├── prometheus-15.5.4.tgz     \n│   └── promtail-6.14.1.tgz       \n├── requirements.lock             \n├── requirements.yaml             \n├── templates                     \n│   ├── NOTES.txt                 \n│   ├── _helpers.tpl              \n│   ├── datasources.yaml          \n│   └── tests                     \n└── values.yaml</code></pre></div>\n<p>loki-stack 디렉토리에서 values.yaml 파일을 수정하여 원하는 기능을 키고 끄고 추가로 설정할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">loki</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">promtail</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">grafana</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token punctuation\">...</span></code></pre></div>\n<p>저희가 사용할 서비스는 loki와 promtail 인데 기본값이 <code class=\"language-text\">enabled:true</code> 이기 때문에 수정하지 않고 배포합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ helm <span class=\"token function\">install</span> loki-stack <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">--namespace</span> monitoring</code></pre></div>\n<hr>\n<h3 id=\"배포시-오류\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC%EC%8B%9C-%EC%98%A4%EB%A5%98\" aria-label=\"배포시 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포시 오류</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm <span class=\"token function\">install</span> loki-stack <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">--namespace</span> monitoring                                │\nError: INSTALLATION FAILED: An error occurred <span class=\"token keyword\">while</span> checking <span class=\"token keyword\">for</span> chart dependencies. You may need to run <span class=\"token variable\"><span class=\"token variable\">`</span>helm dependency build<span class=\"token variable\">`</span></span> to fetc│\nh missing dependencies: found <span class=\"token keyword\">in</span> Chart.yaml, but missing <span class=\"token keyword\">in</span> charts/ directory: loki, promtail, fluent-bit, grafana, prometheus, filebeat│\n, logstash</code></pre></div>\n<p>만약 설치시 위와 같이 문제가 생긴다면 <code class=\"language-text\">helm dependency build</code> 을 통해 의존성을 설치하신 후 진행하시면 됩니다.</p>\n<hr>\n<h2 id=\"확인\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9D%B8\" aria-label=\"확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확인</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get po <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>조금 후 해당 namespace의 pod 목록을 출력해보면 아래와 같이 Running이 되고 있습니다!설치가 완료되었습니다…!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABH0lEQVQY02WPUW6DMBBE13aCwQZDICEESCDkp5fp/Q+zladLXKlS+/G0lmb9NEvjcP4quw9210/WjWbbFByaE/sQuG5bDqcTZ0XBOss4s5brOrArHNeS53nObSu73rFznrU2TLrvQeczqHYgV4LKCpTnv1gL8l4ywRqooOCNx2QneOthcwutCMOgoDWBaBwjTXOk9SlzirQsUUSRiP5jhIpipau4ZVsMeYjmYN7Zc6VoreRqHEHDINxA+/t+B+2td+pGqEFVlZoelVxAcMphzlJDEUJJw67d2+3MM+h2S0xTEvfXJF6WNC8XUCZCQ2+h1x7zcUL5Fh7+CJ8b6PFIn18vEch7XZNop+t+FqXdQWYgyMl42Q1yMswxCfs+Cb8B7hKGhEseKgUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"loki-get-po\"\n        title=\"loki-get-po\"\n        src=\"/static/e58d400ddc99fd66db784c9952919117/7c811/loki-stack-get.png\"\n        srcset=\"/static/e58d400ddc99fd66db784c9952919117/103f2/loki-stack-get.png 165w,\n/static/e58d400ddc99fd66db784c9952919117/748ba/loki-stack-get.png 330w,\n/static/e58d400ddc99fd66db784c9952919117/7c811/loki-stack-get.png 660w,\n/static/e58d400ddc99fd66db784c9952919117/d28e0/loki-stack-get.png 990w,\n/static/e58d400ddc99fd66db784c9952919117/bb51b/loki-stack-get.png 1320w,\n/static/e58d400ddc99fd66db784c9952919117/10796/loki-stack-get.png 1354w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"promtail에서-로그가-수집안되는-이슈\" style=\"position:relative;\"><a href=\"#promtail%EC%97%90%EC%84%9C-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%88%98%EC%A7%91%EC%95%88%EB%90%98%EB%8A%94-%EC%9D%B4%EC%8A%88\" aria-label=\"promtail에서 로그가 수집안되는 이슈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>promtail에서 로그가 수집안되는 이슈</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.0606060606060606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAARUlEQVQI1x2KRw6AIBQFvYDSgopUlcT7n3D8sJpXZlFnxuWObx+udPTsLzrUSXNV2YqwYePNtkfUkWYev00Pqw8Y8Yf7A/8IGdLjU2ZiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"promtail\"\n        title=\"promtail\"\n        src=\"/static/0ed47a4b0f466ee94c23c33e2c95dcb2/7c811/promtail.png\"\n        srcset=\"/static/0ed47a4b0f466ee94c23c33e2c95dcb2/103f2/promtail.png 165w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/748ba/promtail.png 330w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/7c811/promtail.png 660w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/d28e0/promtail.png 990w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/bb51b/promtail.png 1320w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/08db2/promtail.png 3402w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>위의 사진처럼 promtail에서 log를 수집할 때에 error level의 로그 수집 오류 내용이 발생할 수 있습니다. 해당 이슈의 원인은 비교적 설치 시간이 짧은 promtail이 loki보다 먼저 설치되어 발생한 이슈인데, promtail Pod를 재시작해주면 해결됩니다!</p>\n<h2 id=\"retention\" style=\"position:relative;\"><a href=\"#retention\" aria-label=\"retention permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Retention</h2>\n<p>기본적으로 <code class=\"language-text\">table_manager.retention_deletes_enabled</code>또는 <code class=\"language-text\">compactor.retention_enable</code>플래그가 설정되지 않은 경우 Loki로 전송된 로그는 영원히 유지됩니다.</p>\n<p>table_manager 통한 보존은 객체 저장소 TTL 기능을 사용하며 boltdb-shipper store와 chunk/index store 에서 작동합니다. 그러나 Compactor을 통한 로그 보관은 boltdb-shipper store 에서만 지원됩니다.</p>\n<h3 id=\"boltdb-shipper\" style=\"position:relative;\"><a href=\"#boltdb-shipper\" aria-label=\"boltdb shipper permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>boltdb-shipper</h3>\n<p>Grafana Loki에서 사용되는 index 및 chunk 데이터를 저장하는 데 사용되는 저장소 엔진 중 하나입니다.</p>\n<p><strong>특징</strong></p>\n<ul>\n<li>인덱스와 로그 청크 모두를 객체 저장소(예: Amazon S3, Google Cloud Storage 등)에 저장합니다.</li>\n<li>객체 저장소만을 사용하기 때문에, 일반적으로 비용이 더 저렴합니다.</li>\n<li>수평 확장이 가능하며, 큰 규모의 로그 데이터를 처리할 수 있습니다.</li>\n<li>Loki의 Compactor 컴포넌트와 함께 사용할 때 더 세밀한 데이터 보존 정책을 설정할 수 있습니다.</li>\n<li>인덱스 데이터를 로컬에 캐싱할 수 있어, 쿼리 성능이 향상될 수 있습니다.</li>\n</ul>\n<h3 id=\"table_manager\" style=\"position:relative;\"><a href=\"#table_manager\" aria-label=\"table_manager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>table_manager</h3>\n<p>Loki 데이터베이스의 핵심 구성 요소로서 로그 데이터의 저장, 유지 관리, 압축 및 정리를 관리하며 데이터베이스의 성능과 공간 효율성을 유지하는 역할을 합니다.</p>\n<p><strong>특징</strong></p>\n<ul>\n<li>로그 데이터를 시간별로 테이블에 저장하는 형태로 데이터를 구성하며, 이를 통해 검색 성능을 최적화합니다.</li>\n<li>설정된 로그 보존 기간 내에 있는 데이터만을 유지하고, 설정보다 오래된 데이터는 자동으로 삭제합니다.</li>\n<li>인덱스 관리</li>\n<li>데이터를 정리하고 필요한 경우 압축하여 저장 공간을 효율적으로 관리합니다.</li>\n<li>설정된 보존 기간이 지난 로그 데이터를 정기적으로 삭제하여 데이터베이스의 용량을 유지합니다.</li>\n</ul>\n<p><strong>설정하기</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">loki</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">...</span>\n\t<span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">table_manager</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">retention_deletes_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">retention_period</span><span class=\"token punctuation\">:</span> 24h\n<span class=\"token punctuation\">...</span></code></pre></div>\n<h3 id=\"compactor\" style=\"position:relative;\"><a href=\"#compactor\" aria-label=\"compactor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compactor</h3>\n<p><strong>특징</strong></p>\n<ul>\n<li><code class=\"language-text\">boltdb-shipper</code> 저장소에서만 지원됩니다.</li>\n<li>단일 인스턴스(싱글톤)로 실행하는 것이 권장됩니다.</li>\n<li>Compactor가 재시작되면 이전에 중단된 지점에서 계속 작업을 수행합니다.</li>\n<li>설정된 <code class=\"language-text\">compaction_interval</code>마다 압축과 보존을 적용하기 위해 루프를 실행합니다.</li>\n<li>\n<p>Compactor의 알고리즘은 다음과 같습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">- 각 테이블을 단일 인덱스 파일로 압축합니다.\n- 전체 인덱스를 순회하여 제거해야 할 청크를 식별하고 표시합니다.\n- 표시된 청크를 인덱스에서 제거하고 디스크에 있는 파일에 참조를 저장합니다.\n- 새로 수정된 인덱스 파일을 업로드합니다.</code></pre></div>\n</li>\n<li>보존 알고리즘은 인덱스에 적용되며, 청크는 즉시 삭제되지 않고 추후에 비동기적으로 삭제됩니다.</li>\n<li>설정된 <code class=\"language-text\">retention_delete_delay</code>가 만료된 후에만 표시된 청크가 삭제됩니다.</li>\n<li>Compactor를 사용하여 보존을 적용할 때는 table_manager가 필요하지 않습니다.</li>\n</ul>\n<p><strong>설정하기</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n\t<span class=\"token key atrule\">loki</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">...</span>\n\t\t<span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token key atrule\">compactor</span><span class=\"token punctuation\">:</span>\n\t      <span class=\"token key atrule\">shared_store</span><span class=\"token punctuation\">:</span> s3 // store가 설정되어 있어야 함\n\t      <span class=\"token key atrule\">retention_delete_delay</span><span class=\"token punctuation\">:</span> 72h\n\t      <span class=\"token key atrule\">retention_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">...</span></code></pre></div>\n<h3 id=\"table_manager-vs-compactor\" style=\"position:relative;\"><a href=\"#table_manager-vs-compactor\" aria-label=\"table_manager vs compactor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>table_manager VS Compactor</h3>\n<p><code class=\"language-text\">table_manager</code>는 데이터의 논리적 구조와 스키마를 관리하고 구성하며, <code class=\"language-text\">Compactor</code>는 저장된 데이터의 물리적인 관리와 최적화를 담당합니다.</p>\n<h3 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.60606060606061%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACcUlEQVQ4y51U247TMBTM/38RAiF4Bh6B3ZW6225vSXNxHDuX5tIOZ06a0m0RolSaJrF9JjPj4wRJmmG92WAlCKMIhXNw3p+v9yJYrtf4+Okz3r3/gC9fv53JJtxNyL+ybuAFel9VN6T3IHCVkIUzuM0TrK/wPF8gzQx8Wf6fZWMtVq8LLOczJEIUpymyPIeVt9miuBuBkeLU5MiLUTKV/as9e8Iby8wskt19eHhEnlsMw/AX9DheAIcRh4s1ARWFYYTvP35K+2zhTlZJXpxU5xILxwrnEdoKYV7pdZF6zGInUeW6Xi3rjkphtIt1Mwj2JrNMskzICh0bs7WYxwWWmVc8hhaznUWUyJysySS6YMqNhHXToNnvpY1qhZPxvu/VipdoGE9VebEp9voOTV3Kc6l1x+NR1wZObEwb4X2pRWXJwkrJFVKwn+4FdcOxE+SZc7UI4DXwYtmIVCrcSJbbaIfF6+q34sviC5JrUIwSUllV1aqCb6FaVdPslXAkfQuuI85OmtFF27anDEUlH/hxeHl+AY4H6YZOwfbouw4tIWuYZyqbZmWztuIokQ3hGOeUkFKpgoNW2iMyBSLXIioa7NweSyPqu0FCl5ccRnADCBJTIe+nOe1DZsAHK6fmNZLPWdEq0do2eIolgn4AfxMRwR8d0d3lnBIyw0EIjfTdJskR+g5bKvQtVrlk0x9YckOYJIkqvCFkqFSYG4PlblRIokkhLf+JkCfMXSt02nu1NOUg3Z5hSct2j5WpsLE15qnsYidnV144DAd1wrxZTMs8qrzXs8wMef54xDIzHq8oThAmmSJKR6TG6Pw1YrE81ubnsV/LB//i11HpIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"s3-index\"\n        title=\"s3-index\"\n        src=\"/static/aa3e5004042055e0586f22e3a280646e/7c811/s3-index.png\"\n        srcset=\"/static/aa3e5004042055e0586f22e3a280646e/103f2/s3-index.png 165w,\n/static/aa3e5004042055e0586f22e3a280646e/748ba/s3-index.png 330w,\n/static/aa3e5004042055e0586f22e3a280646e/7c811/s3-index.png 660w,\n/static/aa3e5004042055e0586f22e3a280646e/d28e0/s3-index.png 990w,\n/static/aa3e5004042055e0586f22e3a280646e/42a19/s3-index.png 1024w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.27272727272728%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVQ4y6VTaXPaMBD1//9Xbacp00ADJOVoQh2OgA9syfcFvO6uEYFOyaTth+eVVqunt4etKI7xfTTGw2iExXKFu/4Ak+kUG8dBfzDE19uu2PVmgyRNwfFxklyFxZ/eXR+33R5G4wluvnTw+aaDn7aNwfBeCLu9b3Bc932EHFCUJYqiQJplKKtK9nw5J19RFqe9IWN7DaIw0grqRwdxFMJeLGHP50Kuo+gi+C1lFykvX17wOJthsVoh1Pq/IClzOiZtTjPP83+GZWry4eMnasSzOJumRl1fR/MHmDNRmJLC9cahTnrw/O0JPiEIQnieD5fA67kfY+LEmHkxBiuNIcFe0znd5RjLFNvfBkKYkUIVtWVQ1BTTeSk6+XScIMmpLGWFkNaeihBQfEUxlVFo0lZUVJadH2sZkZ8t+1J6KEkzIeVREh89lqSJ2Oo8ZUaoNIJQiVJJk9LNslxeLopSVFZHlNJA8pWVgH153jazVUjSlY6ETJN8tlyPOEnlolHcTkA76EJWXZKdCBltdxssaLB5fPa7nQTXZ2Bl7OMmahJgMuGpMGenOTSvPdGA87puiLBukJVUKwLbhnz7/V4uc904MyY+HA7YkQCGEGrpakY1y/A8X+LRjfGwUrBpRKaOxnitMSI8uRGl3Srhy1sqDTeUG8KPlEah/DZKCdTZut2/wvgCRvibPcJ6zw//N/gFMbARnJ1KMeYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"s3-index-retention\"\n        title=\"s3-index-retention\"\n        src=\"/static/df069b0ef5bf0f5b7ed69df1da54127d/7c811/s3-index-retention.png\"\n        srcset=\"/static/df069b0ef5bf0f5b7ed69df1da54127d/103f2/s3-index-retention.png 165w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/748ba/s3-index-retention.png 330w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/7c811/s3-index-retention.png 660w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/d28e0/s3-index-retention.png 990w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/b0f6f/s3-index-retention.png 1042w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>위의 사진을 보시면 loki<em>index</em> 형식으로 log index가 쌓이고 있습니다. 해당 데이터들은 설정된 Retention 값에 따라 gz file로 압축하여 AWS S3에 전송한 후 pod내에선 삭제합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.03030303030303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwklEQVQY062NyQ7CIBRFKR3oQAfUqFWqSWOMW0spH+D/f9P1FYdE3bo4uRMvMHcb4ewEN1lMdiQsnJtgRwMzXGHMQDr4/Npnb6156BesbU/oDhfs9j20PmOz7bFcdSjkCouFJn+EUi0S0SBOFKK4fPoajLFftO7QNAp1XXtdrzeYu7KsUBSStPSdUkufsywHCziESP0mpaS+oD4D5xwsz3MahSedSQWqqkKSxB8/R1GIMOSPI8pBEFAXURe+eb5l+Cd3HzV3pBuAX1kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pod-index\"\n        title=\"pod-index\"\n        src=\"/static/648e42d1f8a629a847d7340822510d72/7c811/loki-pod-index.png\"\n        srcset=\"/static/648e42d1f8a629a847d7340822510d72/103f2/loki-pod-index.png 165w,\n/static/648e42d1f8a629a847d7340822510d72/748ba/loki-pod-index.png 330w,\n/static/648e42d1f8a629a847d7340822510d72/7c811/loki-pod-index.png 660w,\n/static/648e42d1f8a629a847d7340822510d72/d28e0/loki-pod-index.png 990w,\n/static/648e42d1f8a629a847d7340822510d72/bb51b/loki-pod-index.png 1320w,\n/static/648e42d1f8a629a847d7340822510d72/13d1f/loki-pod-index.png 1518w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>실제로 Retention을 24h로 설정한 Loki pod 내부입니다. 총 4일이 지나 loki<em>index</em> 디렉토리가 4개가 생성되어있는데, 가장 최근의 값인 loki<em>index</em>19597에만 log data들이 저장되어 있고 loki<em>index</em>19594의 디렉토리는 비어져있습니다.</p>\n<h1 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h1>\n<p>이렇게 PLG (Prometheus, Loki, Grafana)를 이용하여 모니터링 시스템을 구축해보았습니다! 개인적으로 EFK (Elasticsearch, Fluent-bit, Kibana)보다 가볍지만 강력하다고 생각이 들어요!\n다음엔 Grafana Dashboard 설정에 대해 공부해보고 포스팅 해보도록 하겠습니다!</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://prometheus.io/\">Prometheus - Monitoring system &#x26; time series database</a></p>\n<p><a href=\"https://ksr930.tistory.com/315\">[Helm] kube-prometheus-stack 모니터링 시스템 구축하기 (Grafana, exporter, monitoring)</a></p>\n<p><a href=\"https://grafana.com/docs/loki/latest/operations/storage/retention/#table-manager\">Retention |  Grafana Loki documentation</a></p>","timeToRead":10,"excerpt":"들어가며 사내에서 EFK-Stack(ElasticSearch+Fluent-bit+Kibana)를 이용하여 모니터링 시스템을 구축했었습니다. 하지만 AWS Opensearch를 이용하다보니 비용적인 문제와 비교적 활용도가 낮았던 fluent-bit…","frontmatter":{"title":"kube-prometheus-stack으로 모니터링 시스템 구축하기","date":"2023-08-27 15:40","categories":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"tags":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"description":null,"keywords":"devops","cover":null},"fields":{"slug":"/kube-prometheus-stack","date":"2023-08-27T06:40:00.000Z"}}},"pageContext":{"slug":"/kube-prometheus-stack","nexttitle":"좌충우돌 AWS EKS Nodegroup 전환기","nextslug":"/aws-eks-ng","prevtitle":"KUBERNETES에서 POD가 생성되고 업데이트 되는 과정","prevslug":"/kubernetes-apply-pod","tagList":["Devops","review","Kubernetes","promehtues","loki","grafana","Observability","AWS","AWS EKS","AWS EC2","AWS OpenSearch","EFKStack","EC2","ArgoCD","Slack","metric","K8s","Storage","EKS","Linux","Ubuntu","Gitlab","Jenkins","config","terminal","iterms","git","github","develop","Java","Spring","cron","React.js","Redux.js","Javascript","DB","DataBase","MySQL","vue","spring","mysql","jsp","db"],"categoryList":["Devops","review","Kubernetes","promehtues","loki","grafana","Observability","AWS","AWS EKS","AWS EC2","EFKStack","EC2","ArgoCD","Slack","metric","Storage","Linux","Ubuntu","config","git","Java","React.js","DataBase","develop"],"latestPostEdges":[{"node":{"fields":{"slug":"/2023-review"},"frontmatter":{"template":"post","title":"2023년 회고","tags":["Devops","review"],"categories":["Devops","review"],"date":"2023-12-30 13:00"}}},{"node":{"fields":{"slug":"/kubernetes-apply-pod"},"frontmatter":{"template":"post","title":"KUBERNETES에서 POD가 생성되고 업데이트 되는 과정","tags":["Devops","Kubernetes"],"categories":["Devops","Kubernetes"],"date":"2023-09-13 10:00"}}},{"node":{"fields":{"slug":"/kube-prometheus-stack"},"frontmatter":{"template":"post","title":"kube-prometheus-stack으로 모니터링 시스템 구축하기","tags":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"categories":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"date":"2023-08-27 15:40"}}},{"node":{"fields":{"slug":"/aws-eks-ng"},"frontmatter":{"template":"post","title":"좌충우돌 AWS EKS Nodegroup 전환기","tags":["Devops","Kubernetes","AWS","AWS EKS","AWS EC2"],"categories":["Devops","Kubernetes","AWS","AWS EKS","AWS EC2"],"date":"2023-08-15 13:00"}}}]}},"staticQueryHashes":[]}