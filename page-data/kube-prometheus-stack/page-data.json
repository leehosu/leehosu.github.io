{"componentChunkName":"component---src-templates-post-template-jsx","path":"/kube-prometheus-stack","result":{"data":{"markdownRemark":{"html":"<h1 id=\"들어가며\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가며</h1>\n<p>사내에서 EFK-Stack(ElasticSearch+Fluent-bit+Kibana)를 이용하여 모니터링 시스템을 구축했었습니다. 하지만 AWS Opensearch를 이용하다보니 비용적인 문제와 비교적 활용도가 낮았던 fluent-bit(응답이 길면 Probe가 자꾸 문제가 발생), metirc 데이터 필요, 쿠버네티스에 맞지 않은 설정들등 다양한 이슈로 모니터링 시스템을 바꿔야 하는 요구 사항이 생겼습니다. 그러던 중 쿠버네티스 모니터링 시스템계의 또 하나의 터줏대감인 Prometheus, Loki, Grafana를 이용하여 새롭게 모니터링 시스템을 구축하였습니다.</p>\n<blockquote>\n<p>💡 개념적인 내용은 공식 문서와 ChatGPT를 참고하여 작성하였습니다.</p>\n</blockquote>\n<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<div style=\"width:100%\">\n<p><img src=\"/b476e79d8d7827d58677e505521e4550/overview.gif\" alt=\"overview\"></p>\n</div>\n<h1 id=\"prometheus\" style=\"position:relative;\"><a href=\"#prometheus\" aria-label=\"prometheus permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.303030303030305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABS0lEQVR42o1RO0sDQRDOPxH8IRa2CoKlopUPsPMFor2NYGWK1DE2NpIY0EYucolFDCbocRcu5PLSC3ghxHvs3tztxjkvhERMcIphZr/5dr5vN9KfHNBuQft9ykDk9wHnQXKJfnbU2F/VNhf08xNOyRCaSmY+JiN+Ic/PEqVkF3Ly3IxxGR1CU8k/0ThYq++uBMt8r7az3Dhc/59sxjB9nO41jzdoRaKqhAW2Q2gymbNQG9XK2taiEY+iYG17idbUgWy0HTjnY2TuUg4w+mZe59PKi9azCHpz9Po/NhPxzhGSUJE8TYGqTEtPoCm+XodykWTv6UvWa1VBffU7bai8+YYe7hiQaeERMeTjqJW+wtZ5uDGvY3Ym5WRuaV6w0glbSDpCyk4n3GJujMzBRUscKPvq4q8GLlzCbBNrZvb6nsuJzYnDel1sObFC1jeRnyku0QekwwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prometheus\"\n        title=\"prometheus\"\n        src=\"/static/a740d1b72f8e98e60002294fa2d3f7fa/7c811/prometheus-logo.png\"\n        srcset=\"/static/a740d1b72f8e98e60002294fa2d3f7fa/103f2/prometheus-logo.png 165w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/748ba/prometheus-logo.png 330w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/7c811/prometheus-logo.png 660w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/d28e0/prometheus-logo.png 990w,\n/static/a740d1b72f8e98e60002294fa2d3f7fa/64756/prometheus-logo.png 1200w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"prometheus란\" style=\"position:relative;\"><a href=\"#prometheus%EB%9E%80\" aria-label=\"prometheus란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus란?</h2>\n<p>Prometheus는 SoundCloud에서 처음 개발된 오픈 소스 시스템 모니터링 및 알림 툴킷입니다. 2012년에 시작된 이후로 많은 회사와 조직이 Prometheus를 채택하였고, 매우 활발한 개발자와 사용자 커뮤니티를 가지고 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.87878787878788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACwUlEQVR42oVU7Y6bMBDM+7/GvUVV9VdbVVdVqnLtfeSa3JEPEkgAGwM2BjPdXY5c055UpBVr7B12dmc9875D33nUPmC52WPxcA9TVWjbFnVdoyLfGPNqZYmSrOt76A8rqHe/5Iz3Hl3XYcaBvGisRZ7nyLLs4s37bM65sz+tq7yEyTRqMwKyzUIIGIYBTdNgu90iWq8RRRHiOEaapvJXYAA/fJaN1961UKccBZkp9Hlv1lPqbAwqgcMYXBQFnp8j8Z2l4NzQVpCzrvUIw5jIUHXynnBeARkk3iBdLQTk+voaV1dX4p9Shfv5WnxtGqzjnM4PsMoi+RpTDzrJ7gwoC7LsdESaHGgjoKGGKFXIoaoy0LoQ+lXVID3mUq+WaBe5ku8XgAwwhB6l66FsT7QJsKV144VmYz0sBXNQ2zqUdSV+1/Uw1pHfvwLKBjn8/IhSfL4d67ba5/i+2Ip/VC0SyoqfrDjhZnE3fi9rvP8ZwZH0hssMxz8c0wSHeCf0LXW91Er8hjIqifJI01FX1Qv9Gvv0KBIKbwEyBTaRUdsQnUoysVSKTHspRUv09OAlI0+gSqlz/JnyKJuA5GRQ6FpANnmGOWXLzy6t8HF+GuXU1JgnscirosZ9m99cNiVwhiJK1ldL2YzpBz5EPsvSEPXssCftDXCNFUFzsKXp4jG8oDwCDginBP3TPbrlLVX7gJzEvDFWaNYEnjjLowIfqHZ9I5Q5M557SWAS9uQEKrrdLFETKCqNhyTHp3UqNGOa6S+rR/EVNev2EAllHtflcvkGZdoMhx2c0WhNibDf0E1DXaYuirDplsmPRymNI91ppQWEqTJlviz+raGnW+ThEWa9IZ9mVe3R7e5oDy9zjnM3eT1dBpM/7c36acHyeNpCp5nMtS8SuPhRvvd9dyGNt+yvDHspKmus9aPG+G3/6N4U9D/7DXw5c+hfSMjGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CNCF\"\n        title=\"CNCF\"\n        src=\"/static/8755941b5003f2471579539608ddb03d/7c811/CNCF.png\"\n        srcset=\"/static/8755941b5003f2471579539608ddb03d/103f2/CNCF.png 165w,\n/static/8755941b5003f2471579539608ddb03d/748ba/CNCF.png 330w,\n/static/8755941b5003f2471579539608ddb03d/7c811/CNCF.png 660w,\n/static/8755941b5003f2471579539608ddb03d/d28e0/CNCF.png 990w,\n/static/8755941b5003f2471579539608ddb03d/70841/CNCF.png 1094w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Prometheus는 2016년 Kubernetes 에 이어 두 번째 프로젝트로 Cloud Native Computing Foundation에 합류했으며, 서비스 운영을 위해 모니터링 시스템을 구축할 때 가장 널리 사용되는 툴 중 하나입니다.</p>\n<h2 id=\"특징\" style=\"position:relative;\"><a href=\"#%ED%8A%B9%EC%A7%95\" aria-label=\"특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>특징</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVR42m1Si47DIAzr/3/pnXYtz44CBZ9Ny9STLhLa4iSO421Bb6j5QKkVJWe01tBrIZZRCj+JK3rJqMzL/fp5ogaHXOrIT+aKpTFx6w82Y7CuK9Jx4DwSDL8bYtu2jYEjeFjmF2bGwvD6hrFuYCmli7CS2VgLy+e9x/v9HqTOOYQQBpY5vBM3N6EwKfcxwnFO2L7vF2Hv/c9pCskX/gzV1ZdvWxSRCw8unzXNLJ3+7dsK58PYdraOFj2CNbBUGaliENKGwLOlOsYdhXl6fQ2Vum72LWKfpxj6JemJ59nbPy1Rj3Dl6hOpfkDVttnH5UOhzhO7nvzTsAzWoLCPhyTU0FjIuuZUuxTHgcuKBf+ECtOTp4fzr/Hx+uH7jF9wrG7siIHb5QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prometheus-point\"\n        title=\"prometheus-point\"\n        src=\"/static/501a3b0a5df3b550e5e082e669268e37/7c811/prometheus-point.png\"\n        srcset=\"/static/501a3b0a5df3b550e5e082e669268e37/103f2/prometheus-point.png 165w,\n/static/501a3b0a5df3b550e5e082e669268e37/748ba/prometheus-point.png 330w,\n/static/501a3b0a5df3b550e5e082e669268e37/7c811/prometheus-point.png 660w,\n/static/501a3b0a5df3b550e5e082e669268e37/d28e0/prometheus-point.png 990w,\n/static/501a3b0a5df3b550e5e082e669268e37/74b07/prometheus-point.png 1238w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li><strong>다차원 데이터 모델</strong>: 메트릭 이름과 키/값 쌍으로 시계열 데이터를 식별합니다.</li>\n<li><strong>PromQL</strong>: 이러한 차원성을 활용할 수 있는 유연한 쿼리 언어입니다.</li>\n<li><strong>분산 저장에 의존하지 않음</strong>: 단일 서버 노드가 자립적으로 작동합니다.</li>\n<li><strong>HTTP를 통한 풀 모델</strong>: 시계열 데이터 수집이 HTTP를 통해 이루어집니다.</li>\n<li><strong>서비스 발견 또는 정적 구성을 통한 타겟 발견</strong>: 다양한 그래핑 및 대시보드 지원 모드가 있습니다.</li>\n</ul>\n<p>위처럼 여러 특징이 있지만 주요 특징은 2가지로 요약됩니다.</p>\n<p><strong>Pull-Based Monitoring</strong></p>\n<p>기존의 Push-Based Monitoring 방식 대신에 Pull-Based Monitoring을 사용합니다. 대상 서버에 설치된 Exporter가 메트릭 정보를 수집하고, 이 데이터는 수집 서버가 주기적으로 가져가는 구조입니다. </p>\n<p>즉, 클라이언트에서 서버로 데이터를 보내는 것(PUSH)가 아닌 서버가 클라이언트의 데이터를 수집(Pull) 방식입니다. 이러한 방식은 기존의 에이전트(agent) 방식보다 더 유연하고 관리하기 쉽습니다.</p>\n<p><strong>시계열 데이터베이스(TSDB)</strong></p>\n<p>관계형 데이터베이스(RDB) 대신 메트릭 이름과 key-value 쌍으로 식별되는 시계열 데이터 모델을 사용합니다. 이를 통해 대량의 정보를 빠르게 검색할 수 있습니다.</p>\n<h2 id=\"architecture\" style=\"position:relative;\"><a href=\"#architecture\" aria-label=\"architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADZklEQVR42jWSW2gjZRTHT7Ok6eqC4CL4IuIuCmFZn4oFH1RKQRBWLEhFRPRNqLgiq+J6gb4tFh9c15U+KG7xwd0sygpVcGMu7Waa627aSTuTJplJZjKXTCZzyUxmmpkk/fwS64EfBw58/++c8z8gy/L9Js8rsiRVOVF9xrC9jZ7bR6Kk9Bu84DN1zrdwoXfoo449eg4hBDhOY4L1gxKUG5XzxTb9A6UzNxiFew0Mw/hGllsPdF3/2+r1wkLbSQtSB/E8h3TDQLiORFFEhmkhtaUt9EV2ubm/+7NSoX4aMVSY5phZVuWqvCZKgi5/AuMfSyR55UEmHdZNDaqCfoGkqrcPmuo7kjV4XTT7Swd8e4mRzDfqO3tPDLQWPdDbaKApqNuoLjea4mxXM7Y1VSNdx/0A/E4r5XUUwtfaxT5XnfdV6U21wdzzWOqyXytd9Fnqo5FU/xD1zE/dvdwZ/uqXIe/Ke8HO91+EiD/vPM7x/JJlWRWMhvkcPJkvunytOFSE7WGjPD/qH5IY5Kky8toSwp+hgWWgo9EIHQr1xbbQhK2trWUik3s2RxBQ3isFcrncowRBnK5UKidhZJuAmCJk8oW3799LPu92jS3bcZDT9zzMwPX8gW6afavbRa5Qf2WfoiEeiy0kYrEz43WJdOnELlmCQqEALMsCpDaTJ25d/zaYy+ffL6ZTLzqGnhqbYdvWEBtyZHXNo65tDx1/gBSafBW7G8JM7WczgPga9JsN4E1j6vdIZGqnVIKxyxNjCmkCFnFGvreD/ovhcUZHenvoZaLIbtYvjMUw057IXfIlLobzV8enBFcvfwxAUdRLNE0vVGu12euXlmcaZequ0uQNtkwJdyI3pdw2IbUqdJMn4tZBPj1fJncnDbhi5ReDoZArVv+IyAje+vrXqYkq7hCpqopHtBEWDSeTyQTDMAgv3p6bm3NWVlYcUZLtGseju9Hoy2OxCQPlhi3tI5x/wzIPBQLT50/OTD8C+Xz+hfX19Xfj8fhiz7Yf3tjYeDK5uXkum82GbXzoNYYJYxPCyX+i525Hbp06+9TTE0Gzw/zoyGnkmuxNLHgqGAydnQlhweP5H8MEVldXIRqNQiKRgFQqBYIgAEmSEIvFAHcOa2trcO3ad4Hxm3Q6c7FQJP/K5vKf9RwD/o9/AVT1p3I0GeMkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prometheus-architecture\"\n        title=\"prometheus-architecture\"\n        src=\"/static/2ada1ece66fcc81d704c2ba46f9dd7d3/7c811/architecture.png\"\n        srcset=\"/static/2ada1ece66fcc81d704c2ba46f9dd7d3/103f2/architecture.png 165w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/748ba/architecture.png 330w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/7c811/architecture.png 660w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/d28e0/architecture.png 990w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/bb51b/architecture.png 1320w,\n/static/2ada1ece66fcc81d704c2ba46f9dd7d3/f631a/architecture.png 1351w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><strong>Exporter</strong></p>\n<ul>\n<li>host서버에 설치되어 메트릭 데이터를 수집하는 역할을 합니다.</li>\n<li>Prometheus 서버가 접근하여 데이터를 가져올 수 있는 HTTP 엔드포인트를 제공하여 다양한 데이터를 수집합니다.</li>\n</ul>\n<p><strong>Prometheus Server</strong></p>\n<ul>\n<li>Prometheus Server는 메트릭 데이터를 스크랩하고 저장합니다.</li>\n<li>메트릭 데이터 수집 주기를 설정하여 지정된 시간마다 대상 서버에 있는 Exporter로부터 데이터를 수집합니다.</li>\n<li>수집한 데이터를 저장하고 PromQL(프로메테우스 쿼리 언어)를 사용하여 데이터를 쿼리하고 필터링할 수 있습니다.</li>\n</ul>\n<p><strong>Grafana</strong></p>\n<ul>\n<li>Grafana는 데이터 시각화 도구로, Prometheus가 수집한 메트릭 데이터를 그래프나 대시보드 형태로 시각화하여 표현할 수 있습니다.</li>\n<li>Prometheus Server에서 직접 제공하는 웹 뷰보다 더 다양한 시각화 기능을 제공하며, Grafana를 통해 데이터를 더 직관적으로 이해할 수 있습니다.</li>\n</ul>\n<p><strong>Alertmanager</strong></p>\n<ul>\n<li>Prometheus가 수집한 메트릭 데이터를 기반으로 경고를 생성하고 규칙을 만들어 관리합니다.</li>\n</ul>\n<p>이렇듯 Prometheus로 metric 데이터를 수집하려고 했지만 Docker형태나 pod 형태로 배포하기엔 따로 작업을 해야해서 다른 방안이 없나하고 찾아보던 중 Prometheus, Grafana, Alertmanager 등을 함께 묶어 kubernetes 환경에 맞게 Helm 차트 형태로 설치할 수 있는 kube-prometheus-stack을 발견했습니다..!</p>\n<h1 id=\"kube-prometheus-stack\" style=\"position:relative;\"><a href=\"#kube-prometheus-stack\" aria-label=\"kube prometheus stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kube-prometheus-stack</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEyUlEQVR42m1UbWxTVRg+dI6QiBgMoslkUxgR2t57W2DoohIimkWicbJkyygaWLeu6+3HFjKHGBN/oHwMAzqBCD8IweAw0R+GRFA+FAxixhjOIXQwut1z79267pt1S7e2r+97WqM/OMmbe+45533Oc573g7GHjBVbO5is9s2R/cZc2a8z2c89ssq9+I9zI1f29TGnL8weOiRvD7PXdiOANkfxczFXAmaOVNfDJJUzZ2iArQoZp9BaaU5r5IPAOVLtHTyrC1+bJ8zs3nsIWHcfJ3eJEW72Wxyh2BwERKfuR5FVpSNgtCyr5rywmuvOoPEFApZLteF5xFYJRi34teA5ZvN0I04PAfYQoEX29T6jBAcYGR7YqviNKILBilodgkdH0nVHRmeWe3RwBA1AEBNl2IwEmOQ3iWEBAlqygBECXIBa9aPtQtuHDqAEDLN4u+5jbGg+TA4eB+32g4YzsHJ5VeQ9vMigM3j204wZA3ZPeAG9lsl4iyxu4S/gxpQcMAHZ/QoAzHUkwa5cCrNpQwuMnz4CMDNR//5hjeEW+uiXUBpiG0eGRZngGYyAhAa4WIgL43RIUo3J9U1G4yzAWoBJlkqna4Z2ByD+24/tLABzl22LNCLL6QxLY0z4CgxuwUAMWBTBUj9KB1aHtM0YgI6K5mFImr0wOzH65mwytWvAWwKTpz4f/+EuXFvXqIO1zmhzBLTN2ad/ldE/miOCYnN35pIOaB357ihjjrOLXt2TuMC/a4Vk1+/9U22/RPn6xTDReiiVHh2ET06a5xm7tZCVmAzl+VNoWHMrN6OhqjGM8LPZmw4urTbYlq+B3QEoiLUemxn52A2DoVLQNy5NPfimJTX2/XGUF4p3fptgi7aY9LKD5IvBfY5Sj6qAFvOFwCpvLtnRnfdERaTpxOXE1elmFbTXlqSMUmvKLHfC4EdV6akvm+DQT4lrC8vv73hj5/089N2T9S0gHZmiRuYjyy3ZVJlSVB3soRhcPHcbxl1Kmr9tA7NMAuMdKxgVa2DE5Ux3XmiDtTtGQPJx4SNep/IqlO9xCnU3Wh+lDG4mrZ7IgfX7wTt8/gzvL7MjkD1lbrKnhZXJab4hD+Inm2d2X4adS1x3P8RET4p08+sR/N6jJzso5yipERBsVbeLrK+cZg/ar7abFasQ0JY0N0kgAMudab2kAIZPHyMd5z1Wcn0VVRP67i3+DCgediYSErsHBuYpjFgc63WQscpcdPDE9jdC77onZ/VSW0pHHftez5/R330ZgHeee/oALMZnDiGJBPrmCQwMMCUjtalHRGtSeRmxRG3+emkfrIQ4PzW11wuxSifEXGtgcvtbAG1n9JNtoBa6tZuOoAiGC32YwMCWJ5pB4YZd9LVQl0HG2xwYNZuXjxd/MHz47I3pn3v/6Pi791p71/nrYx2VLfELy2v4mADz6z4qXeo6dvcNpoRi2Z6IPVCq6aK6ziGmkk/bSKCST4elbg5S/RBIDUOAOQorPBwIDNvYJqx7IoJ9MYwFcu+/JiuS268RoCXTLPQDCHxldbD3+aIQDyo+bZ/s05rXhHjDiw19Vty/iPtHRbmRj59n9Pv/oCx31I9m+qGft6A2pRQwbBTM6utnK9FonnHmG6h+5UCUOTw3xdq/4x/JLB0HySrfLwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kps\"\n        title=\"kps\"\n        src=\"/static/6b270f686608d58dc036437bdf92f868/d9f49/kube-prometheus-stack.png\"\n        srcset=\"/static/6b270f686608d58dc036437bdf92f868/103f2/kube-prometheus-stack.png 165w,\n/static/6b270f686608d58dc036437bdf92f868/748ba/kube-prometheus-stack.png 330w,\n/static/6b270f686608d58dc036437bdf92f868/d9f49/kube-prometheus-stack.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"kube-prometheus-stack이란\" style=\"position:relative;\"><a href=\"#kube-prometheus-stack%EC%9D%B4%EB%9E%80\" aria-label=\"kube prometheus stack이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kube-Prometheus-Stack이란?</h2>\n<p>kube-prometheus-stack은 kubernetes cluster에 맞게 구성된 오픈 소스 프로젝트입니다. Prometheus를 기반으로 하며, 쿠버네티스 클러스터의 다양한 컴포넌트들의 메트릭 데이터를 수집하고 이를 시계열 데이터로 생성하여 모니터링 및 경고 기능을 제공합니다.</p>\n<p>즉, 쿠버네티스 클러스터만 있다면 간단하게 helm chart로 설치가 가능합니다!</p>\n<p>github : <a href=\"https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack\">https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack</a></p>\n<h2 id=\"architecture-1\" style=\"position:relative;\"><a href=\"#architecture-1\" aria-label=\"architecture 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.36363636363636%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACG0lEQVR42iWSO2/UQBSF/U8paOj5BxTU/AKEEBQUUABCCkiRQChISEmIssnu2hvHj7HHO573wx7PeDwYcouj2xzdo/PdRCsBYdOC0kge/09Y/ul14d6eqhoASvCyRDcvkw9MaqWHEJbJzXMIiahznqdMKoT6I+XWzVKPzEybavi50UIIH8Iw+YKMFTF1tq8rwJQR2ipjkzrb3V79yYmtjqzAqrm+Nptz7SMgusQay/FQ1BAzZhxT1h++8zbfHQoqlB6nZJ93J79bKk3bs1Wr+7K+uRScv/hWPXm9O8voMkmjNGSDn5dhDtbPa/7BOj+HBNRwk0FmLCQKYr5vyI8NyI76yxV6c9au5l+Fvs8azrW2XsGWc0m4ZGvu0SZtBbYXN0VDyo4Rxr/e4Mevds8/588+5k/fZc8/3T16efv+dK/MeAcZPvnQAZAXVVG3qj0maVpus7rjY4lkfaQFNvtGFHiokazq/qgnIB1ukJPahzX2MobFzmEI0ROacEq2gO4aSoQK0xgecBkdlRjvSlF2kfTxkMbdNpZlJCT2KEoZwxwJThY/BW+Ds4JiKYQyw8rQrZ0skaRlc5GGPPfnl+78wt9uHWgnyjzjjgknVfJwaXL+HnRpXgB41KOjQiPKtXUr/56rHhHeoZ7yFYe0HkvN1ECUXc3rQy1r81SNEGHMpDBT17MSQCaHBtF1qTuM5VC3CPaEqxHAHiKCmP4Lf01chc89qw4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kps-architecture\"\n        title=\"kps-architecture\"\n        src=\"/static/ec9145e6291d38ca2d6b4a310a081b2a/7c811/architecture-kube-prometheus.png\"\n        srcset=\"/static/ec9145e6291d38ca2d6b4a310a081b2a/103f2/architecture-kube-prometheus.png 165w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/748ba/architecture-kube-prometheus.png 330w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/7c811/architecture-kube-prometheus.png 660w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/d28e0/architecture-kube-prometheus.png 990w,\n/static/ec9145e6291d38ca2d6b4a310a081b2a/bbbf7/architecture-kube-prometheus.png 1280w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><strong>Prometheus Operator</strong></p>\n<ul>\n<li>쿠버네티스 내에서 Prometheus 서버와 관련된 리소스들을 관리하기 위한 컨트롤러입니다.</li>\n<li>Prometheus와 관련된 설정, 서비스 디스커버리, 룰 및 대시보드를 관리할 수 있습니다.</li>\n</ul>\n<p><strong>Prometheus Server</strong></p>\n<ul>\n<li>고가용성을 제공하는 Prometheus 서버입니다.</li>\n<li>메트릭 데이터를 스크랩하고 저장합니다.</li>\n</ul>\n<p><strong>Alertmanager</strong></p>\n<ul>\n<li>Prometheus가 수집한 메트릭 데이터를 기반으로 경고를 생성하고 관리하는 역할을 합니다.</li>\n</ul>\n<p><strong>Prometheus node-exporter</strong></p>\n<ul>\n<li>node-exporter는 Host의 metric을 수집하는 역할을 합니다.</li>\n<li>CPU, 메모리, 디스크 사용량 등의 데이터를 수집하여 Prometheus로 전달합니다.</li>\n</ul>\n<p><strong>Prometheus Adapter for Kubernetes Metrics APIs</strong></p>\n<ul>\n<li>쿠버네티스의 메트릭 API와 연동하여 클러스터 내부의 리소스 메트릭 데이터를 수집하고 Prometheus로 전달합니다.</li>\n</ul>\n<p><strong>kube-state-metrics</strong></p>\n<ul>\n<li>쿠버네티스 클러스터의 상태 정보를 메트릭으로 수집합니다.</li>\n<li>파드, 디플로이먼트, 노드 등의 상태 정보를 모니터링할 수 있습니다.</li>\n</ul>\n<p><strong>Grafana</strong></p>\n<ul>\n<li>Grafana는 데이터 시각화 및 대시보드 생성 도구로, 수집한 메트릭 데이터를 그래프나 대시보드 형태로 시각화하여 사용자에게 제공합니다.</li>\n</ul>\n<h2 id=\"구성\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%EC%84%B1\" aria-label=\"구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구성</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 268px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.36363636363636%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVR42qWVV2/DMAyE7Qxk772XnT0RJEAe8v9/FouPAFEXbVM5fSBEyMqJxzsqXq1Wk2w2K4VCQUajkQwGA+n3+9JsNjVvtVpSr9cll8uJ53l/R7vdVsDxeCyPx0MOh4Ps93vZ7XZyOp10n4tKpZIbYKfT0cNUtVwupdvtSj6fl9VqpRU6gUQDgGq1qj++XC5yPp+1qtvtpnQ55Pu+O6BRhtb1epXn8ymTyUSGw6Hux64QwGKxqI1fLBZKvdFoxAeyAIikXC4rRVb6B3gymfwfIEGFgAVBIMfjUaunh6lUStLptK4vL4oC4kn8BxDCzGYzCcNQ8/V6rRchIvsm1jfBDBCl6ScBZdTGk9vtVkUCDF+Ss49PEZKLEonEJyBVkeA9quz1evrjzWajh/EmlqKq+XyuYHzHBZwhJ6wwVRljUyETAl0qJLdxo2dUwWo5+/SU/AttLMJmpVJRutx2v98VEIGm06lkMpn3VAYcM0MNMegf36GMMLEAoU3gRfpFMIqsjGFUWSdAowwgjYeqNd2Ee4syPkRdKgKUHLoEwtEO9p0oMxVUyQ+YFMDYR20Y8AhT7cu3MUoZuvgQMOhiZPzGt9iUDZDRQmGbBuzDRPAQ28q0/Pq0GSC08Bs9tCmx3hl9LrQR5ZH4ERAAbkMUFDXLMC1Qtr6xOlEGjMoQxHpo4jAp0cMufwUfOs4XGG/IMywAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kps-chart\"\n        title=\"kps-chart\"\n        src=\"/static/6e3dd2ffffd6c38801fee546e6edc792/baf7c/kps-helm.png\"\n        srcset=\"/static/6e3dd2ffffd6c38801fee546e6edc792/103f2/kps-helm.png 165w,\n/static/6e3dd2ffffd6c38801fee546e6edc792/baf7c/kps-helm.png 268w\"\n        sizes=\"(max-width: 268px) 100vw, 268px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>kube-prometheus-stack을 포함한 대부분의 Helm 배포 패키지는 비슷한 구성으로 이루어져있습니다.</p>\n<p><strong>charts</strong> </p>\n<ul>\n<li>Helm 차트의 종속 차트를 포함하는 위치입니다.</li>\n<li>이 패키지의 경우 grafana, kube-state-metrics, prometheus-node-exporter가 존재합니다.</li>\n</ul>\n<p><strong>templates</strong></p>\n<ul>\n<li>Helm 차트의 템플릿 파일들을 포함합니다.</li>\n<li>템플릿은 Kubernetes 리소스의 정의를 작성하는 데 사용되며, 애플리케이션의 배포, 서비스, 구성 등을 관리할 수 있습니다</li>\n</ul>\n<p><strong>crds</strong> </p>\n<ul>\n<li>Custom Resource Definitions(CRDs) 파일을 포함할 수 있는 위치입니다.</li>\n<li>Kubernetes API에 사용자 정의 리소스와 그에 대한 스키마를 추가하는 데 사용됩니다.</li>\n</ul>\n<p><strong>Chart.yaml</strong> </p>\n<ul>\n<li>Helm 차트의 메타 정보를 정의합니다.</li>\n<li>메타 정보에는 차트의 이름, 버전, 유형, 유지 보수자 정보 등이 포함됩니다.</li>\n<li>종속 차트, 애플리케이션의 버전 제약 조건 등을 지정할 수도 있습니다.</li>\n</ul>\n<p><strong>values.yaml</strong></p>\n<ul>\n<li>Helm 차트의 기본 구성 값을 정의합니다.</li>\n<li>애플리케이션의 설정 옵션, 환경 변수, 리소스 크기 등을 설정할 수 있습니다.</li>\n<li><code class=\"language-text\">values.yaml</code> 파일에 정의된 값은 템플릿 파일 내에서 사용될 수 있으며, 차트를 배포할 때 사용자 지정 값으로 수정하여 배포할 수도 있습니다.</li>\n</ul>\n<h2 id=\"설치하기\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\" aria-label=\"설치하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치하기</h2>\n<h3 id=\"create-namespace\" style=\"position:relative;\"><a href=\"#create-namespace\" aria-label=\"create namespace permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>create namespace</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl create namsespace monitoring</code></pre></div>\n<p>먼저 KPS을 설치할 네임스페이스를 생성합니다.</p>\n<h3 id=\"add-helm-repo\" style=\"position:relative;\"><a href=\"#add-helm-repo\" aria-label=\"add helm repo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add Helm repo</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 헬름 차트의 저장소 추가</span>\n$ helm repo <span class=\"token function\">add</span> prometheus-community https://prometheus-community.github.io/\n$ helm repo update</code></pre></div>\n<p>Helm을 통해 prometheus-community repo를 cluster에 받아옵니다.</p>\n<h3 id=\"pull-helm-config-file\" style=\"position:relative;\"><a href=\"#pull-helm-config-file\" aria-label=\"pull helm config file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pull helm config file</h3>\n<p>몇가지 커스텀을 해야하기 때문에 config에 대한 값을 수정할 수 있는 manifast file을 다운로드 한 후 압축을 풀어줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ helm pull prometheus-community/kube-prometheus-stack\n$ <span class=\"token function\">tar</span> xvfz kube-prometheus-stack-<span class=\"token variable\">${version}</span>.tgz <span class=\"token comment\">#설치된 버전을 작성하시면 됩니다!</span></code></pre></div>\n<h3 id=\"service-수정\" style=\"position:relative;\"><a href=\"#service-%EC%88%98%EC%A0%95\" aria-label=\"service 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>service 수정</h3>\n<p>대시보드 형태로 외부에서 접근할 수 있게 <code class=\"language-text\">prometheus-grafana</code>만 clusterIP에서 LoadBalancer나 NodePort로 변경합니다. (이 글에선 loadbalancer로 설정하였습니다)</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">grafana</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\t<span class=\"token punctuation\">...</span>\n\t<span class=\"token comment\">## Passed to grafana subchart and used by servicemonitor below</span>\n  <span class=\"token comment\">##</span>\n  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer\n    <span class=\"token key atrule\">portName</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>web\n<span class=\"token punctuation\">...</span></code></pre></div>\n<p>그 후 수정된 values.yaml 파일을 paramater로 주어 helm chart를 배포합니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ helm <span class=\"token function\">install</span> prometheus <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-n</span> monitoring <span class=\"token parameter variable\">-f</span> values.yaml</code></pre></div>\n<h3 id=\"service-확인\" style=\"position:relative;\"><a href=\"#service-%ED%99%95%EC%9D%B8\" aria-label=\"service 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>service 확인</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get svc <span class=\"token parameter variable\">-n</span> mornitoring</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 511px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5klEQVR42i2QW2vCQBBGvyQmWRW0UdvGxNxNvAR9LIggFPrUh/7/f3M6oA+HGWZnzuyuvLZF5xF13ZNhQJ8pShK0WDzjZo3mls+ETi/WwnkxZVzSuobOdSyDJfLzHNU1yneoqFBmcW/Srkel1YejndvSeI6mHtr51mdEIlZE4TLqaUk3rVmFb0i9DY5XkzSoL59UWxOv0Ic1zAKT2Y1kOGP/IhSBCVM1JMrYqMDJXhG3PdG5JTzcCA6/TK5/uOEHbe9E1QPXPIjSLzQ54a9HQvse/zgSrM60+Tvf45bbZcn9knCoZvwDCRJhtosvW68AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"promehteus-service\"\n        title=\"promehteus-service\"\n        src=\"/static/af33bfb74fe139bbca28585779045e35/40f84/prometheus-service.png\"\n        srcset=\"/static/af33bfb74fe139bbca28585779045e35/103f2/prometheus-service.png 165w,\n/static/af33bfb74fe139bbca28585779045e35/748ba/prometheus-service.png 330w,\n/static/af33bfb74fe139bbca28585779045e35/40f84/prometheus-service.png 511w\"\n        sizes=\"(max-width: 511px) 100vw, 511px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>배포되어있는 service를 확인해보면 정상적으로 prometheus-grafana의 servive type이 LoadBalancer로 설정되어 배포된 것을 확인할 수 있고, <code class=\"language-text\">EXTERNAL-IP</code> 에 명시된 외부 IP 주소로 접근하실 수 있습니다. </p>\n<p>(후에 AWS Route53와 같은 DNS service를 통해 해당 주소를 routing 해주시면 좋습니다!)</p>\n<p>자! metric data 수집과 모니터링 구축은 완료했습니다. 이제 log를 수집해보겠습니다.</p>\n<h1 id=\"loki-stack\" style=\"position:relative;\"><a href=\"#loki-stack\" aria-label=\"loki stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki-Stack</h1>\n<h2 id=\"loki-stack이란\" style=\"position:relative;\"><a href=\"#loki-stack%EC%9D%B4%EB%9E%80\" aria-label=\"loki stack이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki-stack이란?</h2>\n<p>Loki-Stack은 Loki 로깅 엔진을 포함하지만, 추가적으로 로그를 수집, 집계, 시각화하기 위한 다른 컴포넌트들도 함께 제공합니다. </p>\n<ul>\n<li><strong>Loki</strong>: 로그 데이터를 저장하고 쿼리합니다.</li>\n<li><strong>Promtail</strong>: 로그 데이터를 수집하고 Loki로 전송합니다.</li>\n<li><strong>Grafana</strong>: 로그 데이터를 시각화합니다.</li>\n</ul>\n<h3 id=\"loki-vs-loki-stack\" style=\"position:relative;\"><a href=\"#loki-vs-loki-stack\" aria-label=\"loki vs loki stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki VS Loki-Stack</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>구성 요소</th>\n<th>기능 범위</th>\n<th>용도</th>\n<th>설치 및 관리</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>loki</td>\n<td>로깅 엔진</td>\n<td>로그 저장 및 쿼리에 중점</td>\n<td>다른 로깅 시스템이나 시각화 도구와 통합</td>\n<td>단일 컴포넌트로 더 간단하게 설치 및 관리</td>\n</tr>\n<tr>\n<td>loki-stack</td>\n<td>로깅 엔진, 로그 수집기, 시각화 도구까지 포함</td>\n<td>로그 수집부터 저장, 쿼리, 시각화까지 전체 로깅 파이프라인 제공</td>\n<td>독립적인, 통합된 로깅 솔류션을 제공</td>\n<td>여러 컴포넌트를 관리해야하므로 설정과 관리 복잡</td>\n</tr>\n</tbody>\n</table>\n<p>loki만이 아니라 promtail과 여러 컴포넌트를 쉽게 사용할 수 있는 loki-stack을 선택해서 배포하도록 하겠습니다. </p>\n<h2 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/grafana/helm-charts</code></pre></div>\n<p>위의 명령어로 helm chart를 받아옵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> helm-charts/charts/loki-stack</code></pre></div>\n<p>grafana/helm-chart 레포지토리를 clone하여 받아온 후 loki-stack 디렉토리로 이동합니다.</p>\n<p><strong>디렉토리 구조</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./                                \n├── Chart.yaml                    \n├── README.md                     \n├── charts                        \n│   ├── filebeat-7.17.3.tgz       \n│   ├── fluent-bit-2.6.0.tgz      \n│   ├── grafana-6.43.5.tgz        \n│   ├── logstash-7.17.3.tgz       \n│   ├── loki-2.16.0.tgz           \n│   ├── prometheus-15.5.4.tgz     \n│   └── promtail-6.14.1.tgz       \n├── requirements.lock             \n├── requirements.yaml             \n├── templates                     \n│   ├── NOTES.txt                 \n│   ├── _helpers.tpl              \n│   ├── datasources.yaml          \n│   └── tests                     \n└── values.yaml</code></pre></div>\n<p>loki-stack 디렉토리에서 values.yaml 파일을 수정하여 원하는 기능을 키고 끄고 추가로 설정할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">loki</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">promtail</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">grafana</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token punctuation\">...</span></code></pre></div>\n<p>저희가 사용할 서비스는 loki와 promtail 인데 기본값이 <code class=\"language-text\">enabled:true</code> 이기 때문에 수정하지 않고 배포합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ helm <span class=\"token function\">install</span> loki-stack <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">--namespace</span> monitoring</code></pre></div>\n<hr>\n<h3 id=\"배포시-오류\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC%EC%8B%9C-%EC%98%A4%EB%A5%98\" aria-label=\"배포시 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포시 오류</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm <span class=\"token function\">install</span> loki-stack <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">--namespace</span> monitoring                                │\nError: INSTALLATION FAILED: An error occurred <span class=\"token keyword\">while</span> checking <span class=\"token keyword\">for</span> chart dependencies. You may need to run <span class=\"token variable\"><span class=\"token variable\">`</span>helm dependency build<span class=\"token variable\">`</span></span> to fetc│\nh missing dependencies: found <span class=\"token keyword\">in</span> Chart.yaml, but missing <span class=\"token keyword\">in</span> charts/ directory: loki, promtail, fluent-bit, grafana, prometheus, filebeat│\n, logstash</code></pre></div>\n<p>만약 설치시 위와 같이 문제가 생긴다면 <code class=\"language-text\">helm dependency build</code> 을 통해 의존성을 설치하신 후 진행하시면 됩니다.</p>\n<hr>\n<h2 id=\"확인\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9D%B8\" aria-label=\"확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확인</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get po <span class=\"token parameter variable\">-n</span> monitoring</code></pre></div>\n<p>조금 후 해당 namespace의 pod 목록을 출력해보면 아래와 같이 Running이 되고 있습니다!설치가 완료되었습니다…!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABIElEQVR42mWPy3KDMAxFLzbBxsaGEpLwSiDZ9GP6/3+jsSritpsuzkhja46uMI0DNedPqm9fpDpFpq0pdB35GCn2PUXpT3VNqqqoMobaNpKrHbWxJWst9TLjvSPnPCmlCep6ZVwGRusYPjAawVqGsblWRt49wwlGcxHBXntezMLeeJYlrArwOBasFBiYl4RlTdifUqXftiSiBOA/WghIQYX0ql4p2pB0qd9/zx3JmGNunhm3kTEKR7+ujCP1QddJ8pYRQk58KuQCsCscL6ecUGlJLQn7/kh3sN4Z05xZRDZNsuDGuMv7tuV6ueTTS7yFjWr4Xq3cmIZ1Wb6F5/OvcNtzqvuD5WyRLozHI9eDj/5nsMjCkIV7tXOw4U84DFn4DfB9hl2QLd/8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"loki-get-po\"\n        title=\"loki-get-po\"\n        src=\"/static/e58d400ddc99fd66db784c9952919117/7c811/loki-stack-get.png\"\n        srcset=\"/static/e58d400ddc99fd66db784c9952919117/103f2/loki-stack-get.png 165w,\n/static/e58d400ddc99fd66db784c9952919117/748ba/loki-stack-get.png 330w,\n/static/e58d400ddc99fd66db784c9952919117/7c811/loki-stack-get.png 660w,\n/static/e58d400ddc99fd66db784c9952919117/d28e0/loki-stack-get.png 990w,\n/static/e58d400ddc99fd66db784c9952919117/bb51b/loki-stack-get.png 1320w,\n/static/e58d400ddc99fd66db784c9952919117/10796/loki-stack-get.png 1354w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"promtail에서-로그가-수집안되는-이슈\" style=\"position:relative;\"><a href=\"#promtail%EC%97%90%EC%84%9C-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%88%98%EC%A7%91%EC%95%88%EB%90%98%EB%8A%94-%EC%9D%B4%EC%8A%88\" aria-label=\"promtail에서 로그가 수집안되는 이슈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>promtail에서 로그가 수집안되는 이슈</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.0606060606060606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAQ0lEQVR42mMQkJT7LyKn+l9UUQNMg/jCcir/BaXk/wvLgmgFoJg8mBaSUfrPLy7zn19C9r+QtCJYXlhW+T+fqBRcHQAFQBnzyTOEFQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"promtail\"\n        title=\"promtail\"\n        src=\"/static/0ed47a4b0f466ee94c23c33e2c95dcb2/7c811/promtail.png\"\n        srcset=\"/static/0ed47a4b0f466ee94c23c33e2c95dcb2/103f2/promtail.png 165w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/748ba/promtail.png 330w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/7c811/promtail.png 660w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/d28e0/promtail.png 990w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/bb51b/promtail.png 1320w,\n/static/0ed47a4b0f466ee94c23c33e2c95dcb2/08db2/promtail.png 3402w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>위의 사진처럼 promtail에서 log를 수집할 때에 error level의 로그 수집 오류 내용이 발생할 수 있습니다. 해당 이슈의 원인은 비교적 설치 시간이 짧은 promtail이 loki보다 먼저 설치되어 발생한 이슈인데, promtail Pod를 재시작해주면 해결됩니다!</p>\n<h2 id=\"retention\" style=\"position:relative;\"><a href=\"#retention\" aria-label=\"retention permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Retention</h2>\n<p>기본적으로 <code class=\"language-text\">table_manager.retention_deletes_enabled</code>또는 <code class=\"language-text\">compactor.retention_enable</code>플래그가 설정되지 않은 경우 Loki로 전송된 로그는 영원히 유지됩니다.</p>\n<p>table_manager 통한 보존은 객체 저장소 TTL 기능을 사용하며 boltdb-shipper store와 chunk/index store 에서 작동합니다. 그러나 Compactor을 통한 로그 보관은 boltdb-shipper store 에서만 지원됩니다.</p>\n<h3 id=\"boltdb-shipper\" style=\"position:relative;\"><a href=\"#boltdb-shipper\" aria-label=\"boltdb shipper permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>boltdb-shipper</h3>\n<p>Grafana Loki에서 사용되는 index 및 chunk 데이터를 저장하는 데 사용되는 저장소 엔진 중 하나입니다.</p>\n<p><strong>특징</strong></p>\n<ul>\n<li>인덱스와 로그 청크 모두를 객체 저장소(예: Amazon S3, Google Cloud Storage 등)에 저장합니다.</li>\n<li>객체 저장소만을 사용하기 때문에, 일반적으로 비용이 더 저렴합니다.</li>\n<li>수평 확장이 가능하며, 큰 규모의 로그 데이터를 처리할 수 있습니다.</li>\n<li>Loki의 Compactor 컴포넌트와 함께 사용할 때 더 세밀한 데이터 보존 정책을 설정할 수 있습니다.</li>\n<li>인덱스 데이터를 로컬에 캐싱할 수 있어, 쿼리 성능이 향상될 수 있습니다.</li>\n</ul>\n<h3 id=\"table_manager\" style=\"position:relative;\"><a href=\"#table_manager\" aria-label=\"table_manager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>table_manager</h3>\n<p>Loki 데이터베이스의 핵심 구성 요소로서 로그 데이터의 저장, 유지 관리, 압축 및 정리를 관리하며 데이터베이스의 성능과 공간 효율성을 유지하는 역할을 합니다.</p>\n<p><strong>특징</strong></p>\n<ul>\n<li>로그 데이터를 시간별로 테이블에 저장하는 형태로 데이터를 구성하며, 이를 통해 검색 성능을 최적화합니다.</li>\n<li>설정된 로그 보존 기간 내에 있는 데이터만을 유지하고, 설정보다 오래된 데이터는 자동으로 삭제합니다.</li>\n<li>인덱스 관리</li>\n<li>데이터를 정리하고 필요한 경우 압축하여 저장 공간을 효율적으로 관리합니다.</li>\n<li>설정된 보존 기간이 지난 로그 데이터를 정기적으로 삭제하여 데이터베이스의 용량을 유지합니다.</li>\n</ul>\n<p><strong>설정하기</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">loki</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">...</span>\n\t<span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">table_manager</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">retention_deletes_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">retention_period</span><span class=\"token punctuation\">:</span> 24h\n<span class=\"token punctuation\">...</span></code></pre></div>\n<h3 id=\"compactor\" style=\"position:relative;\"><a href=\"#compactor\" aria-label=\"compactor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compactor</h3>\n<p><strong>특징</strong></p>\n<ul>\n<li><code class=\"language-text\">boltdb-shipper</code> 저장소에서만 지원됩니다.</li>\n<li>단일 인스턴스(싱글톤)로 실행하는 것이 권장됩니다.</li>\n<li>Compactor가 재시작되면 이전에 중단된 지점에서 계속 작업을 수행합니다.</li>\n<li>설정된 <code class=\"language-text\">compaction_interval</code>마다 압축과 보존을 적용하기 위해 루프를 실행합니다.</li>\n<li>\n<p>Compactor의 알고리즘은 다음과 같습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">- 각 테이블을 단일 인덱스 파일로 압축합니다.\n- 전체 인덱스를 순회하여 제거해야 할 청크를 식별하고 표시합니다.\n- 표시된 청크를 인덱스에서 제거하고 디스크에 있는 파일에 참조를 저장합니다.\n- 새로 수정된 인덱스 파일을 업로드합니다.</code></pre></div>\n</li>\n<li>보존 알고리즘은 인덱스에 적용되며, 청크는 즉시 삭제되지 않고 추후에 비동기적으로 삭제됩니다.</li>\n<li>설정된 <code class=\"language-text\">retention_delete_delay</code>가 만료된 후에만 표시된 청크가 삭제됩니다.</li>\n<li>Compactor를 사용하여 보존을 적용할 때는 table_manager가 필요하지 않습니다.</li>\n</ul>\n<p><strong>설정하기</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n\t<span class=\"token key atrule\">loki</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">...</span>\n\t\t<span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token key atrule\">compactor</span><span class=\"token punctuation\">:</span>\n\t      <span class=\"token key atrule\">shared_store</span><span class=\"token punctuation\">:</span> s3 // store가 설정되어 있어야 함\n\t      <span class=\"token key atrule\">retention_delete_delay</span><span class=\"token punctuation\">:</span> 72h\n\t      <span class=\"token key atrule\">retention_enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">...</span></code></pre></div>\n<h3 id=\"table_manager-vs-compactor\" style=\"position:relative;\"><a href=\"#table_manager-vs-compactor\" aria-label=\"table_manager vs compactor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>table_manager VS Compactor</h3>\n<p><code class=\"language-text\">table_manager</code>는 데이터의 논리적 구조와 스키마를 관리하고 구성하며, <code class=\"language-text\">Compactor</code>는 저장된 데이터의 물리적인 관리와 최적화를 담당합니다.</p>\n<h3 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.60606060606061%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACeUlEQVR42p1V25KTQBTk///I0ir11dLHXXU1yYZAgHCHGSDc2j6HEFNmfdhNVWeYW9PdcyZx4iSBe/Cwdw/wjwHKqkJV19f2tXAOno+Pnz7j3fsP+PL1mxLd4tWENb9M2xIdasNna64K3wKnsi2q429U3g8UtcVmu0OSpiQ3b7OcFQXc/TP2uw1iEsVJiizPUZTlm6CEaUYCzau6Kvu/rfoGL1g21iIMQzw8PKqycRwV06X99xnjAEwDZm1HfZ6mv2scURSEER4ev8PzjyjLCjlVr7alr88cEwXH3MDPjLa7uMavqEKU5Mi5Ji9oWe1xUxCdaD1DQqxZSiukEsmSbYHnuMQhNfDSGk9hgW1UIIw5xzUy78hbDVVGpxgNy6ftOtimgSEqjg/DoFZqRiPxWFur1XHo0TaGfYL7pnnWtU7FcOvaXIvYGKsHY7lZyBXc0LHtrv0LLn0ZbyhAWrUsGYW0fAxCzfOZ11D6qrjt7tHdQ0QpoSiztrlalZvTnc/aF8KF9BbLOo2FTszqhHNn7lNCIZGOlM92swXmidXQL2B5DH2PnpA1kmcqh8UTFTdxnOiYzCmhSBUVMliyNMKMC6szgrJFVHXYZ1Tfj5jlJdOCmQcgn4S/VJK19NY5rUORLJ2CWbphCq88w80beEWLpxOzGUYlEKIV8gmpUM7gds5ZTrShwgkZrfinjAp7HEkW1R0OObMZJtlyRxjHsVbFHeGicNZqd6NFoRD5JP1JhWL5JYUBM79TqLXHHHoWpYTtholaPWQWPm3vEhKel/s63t5vRhSwzORQhWgdd+RqyRWTayd/B2Gc6FUKiChZINcxfQEnrk0ue1f8AdOC/+YTcT4oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"s3-index\"\n        title=\"s3-index\"\n        src=\"/static/aa3e5004042055e0586f22e3a280646e/7c811/s3-index.png\"\n        srcset=\"/static/aa3e5004042055e0586f22e3a280646e/103f2/s3-index.png 165w,\n/static/aa3e5004042055e0586f22e3a280646e/748ba/s3-index.png 330w,\n/static/aa3e5004042055e0586f22e3a280646e/7c811/s3-index.png 660w,\n/static/aa3e5004042055e0586f22e3a280646e/d28e0/s3-index.png 990w,\n/static/aa3e5004042055e0586f22e3a280646e/42a19/s3-index.png 1024w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.27272727272728%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACKklEQVR42pVUa3PTMBDM//89DHQKpZTvwEApMLSBJI5jyy/5JduJH9u7U+wkhJbhw3qls7xa3Z08y4sC1zfvcf3uBp+/3OLFywu8vnqLnw8PEn91cYnLN1dw1muUxiDLc/A3T2HGjzCKECQpVBgiThIExBzjcRTHwqMQ83OYZbSoLAnuDxhTwFMB/CCAqSoRKMpS8JyrM4cBCbj3t8Is5iklL9Mss/iHq1OH9FAkwkfm48mxCHoU+wv0EeujOUMESzrSfD5HHCdomgZt2z6Jrt2hJzAPXSvousN7EcwJHz5+wnLlyC68QcH5K0oaG2E7LqGLClFeISFWqYGblAh1Pq0XQU56GMXwqSB8bD+wVR6rzjFFMeZlmOFeZVhEBb66Gt83Giuf3tH3rLF3SDnTqQR3ZLugfjN1Lblstlv0Qy9V5z7kjujaLdB3qCs7N8TDMKDv+73DfcmZjalQ0cfCJFpTTuuJT1HtYed2jQhy3oIwwsZTAnfjY+W44rxptmdCguYU1oQZHZYS4F3suBZ3guoU9RS3AgxxR2hGhwxesKV83d19w66pQf1AaWqn1hjBrcHp4Razp/Ild/wtY6oyT3iHlbOGlzVYxAYqr4V/RRZeVqPtOhEYAGk3dsYF6br+UJQ40Ui0lkqvNx5WKsZvP8I6SGS8JCz8GA7NdZoJ+DryNQ2pldIsn27L7M/fEbeG4VYw9qdhjsDzvDjc2/GncXaX/w+HzcfYsaFHE3ASQ3r5evYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"s3-index-retention\"\n        title=\"s3-index-retention\"\n        src=\"/static/df069b0ef5bf0f5b7ed69df1da54127d/7c811/s3-index-retention.png\"\n        srcset=\"/static/df069b0ef5bf0f5b7ed69df1da54127d/103f2/s3-index-retention.png 165w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/748ba/s3-index-retention.png 330w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/7c811/s3-index-retention.png 660w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/d28e0/s3-index-retention.png 990w,\n/static/df069b0ef5bf0f5b7ed69df1da54127d/b0f6f/s3-index-retention.png 1042w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>위의 사진을 보시면 loki<em>index</em> 형식으로 log index가 쌓이고 있습니다. 해당 데이터들은 설정된 Retention 값에 따라 gz file로 압축하여 AWS S3에 전송한 후 pod내에선 삭제합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.03030303030303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAw0lEQVR42qWOSw+CMBCESyFQKQ8FqhIpMdHEs9BCvHnz//+icVuNj3j08GV2J5OdZdebgblYzNZissYzT5PXcTg/GWDGAdaMsOR7fTF8wbabA7ruhF139LTtEWq9R543WK52qOoeTaMhZY0oKhDHK1KJRDRgjBPsG933UEqhKAqUZYmqqqG1piMKQiyQZTl5lc+4WcqMDkbgPKQ9o+Lca5qmVBaDuUEIgSRJXriA47OZc44wDAmOIAi899jfuAz7eflP7lb5d+ZJief8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pod-index\"\n        title=\"pod-index\"\n        src=\"/static/648e42d1f8a629a847d7340822510d72/7c811/loki-pod-index.png\"\n        srcset=\"/static/648e42d1f8a629a847d7340822510d72/103f2/loki-pod-index.png 165w,\n/static/648e42d1f8a629a847d7340822510d72/748ba/loki-pod-index.png 330w,\n/static/648e42d1f8a629a847d7340822510d72/7c811/loki-pod-index.png 660w,\n/static/648e42d1f8a629a847d7340822510d72/d28e0/loki-pod-index.png 990w,\n/static/648e42d1f8a629a847d7340822510d72/bb51b/loki-pod-index.png 1320w,\n/static/648e42d1f8a629a847d7340822510d72/13d1f/loki-pod-index.png 1518w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>실제로 Retention을 24h로 설정한 Loki pod 내부입니다. 총 4일이 지나 loki<em>index</em> 디렉토리가 4개가 생성되어있는데, 가장 최근의 값인 loki<em>index</em>19597에만 log data들이 저장되어 있고 loki<em>index</em>19594의 디렉토리는 비어져있습니다.</p>\n<h1 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h1>\n<p>이렇게 PLG (Prometheus, Loki, Grafana)를 이용하여 모니터링 시스템을 구축해보았습니다! 개인적으로 EFK (Elasticsearch, Fluent-bit, Kibana)보다 가볍지만 강력하다고 생각이 들어요!\n다음엔 Grafana Dashboard 설정에 대해 공부해보고 포스팅 해보도록 하겠습니다!</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://prometheus.io/\">Prometheus - Monitoring system &#x26; time series database</a></p>\n<p><a href=\"https://ksr930.tistory.com/315\">[Helm] kube-prometheus-stack 모니터링 시스템 구축하기 (Grafana, exporter, monitoring)</a></p>\n<p><a href=\"https://grafana.com/docs/loki/latest/operations/storage/retention/#table-manager\">Retention |  Grafana Loki documentation</a></p>","timeToRead":10,"excerpt":"들어가며 사내에서 EFK-Stack(ElasticSearch+Fluent-bit+Kibana)를 이용하여 모니터링 시스템을 구축했었습니다. 하지만 AWS Opensearch를 이용하다보니 비용적인 문제와 비교적 활용도가 낮았던 fluent-bit…","frontmatter":{"title":"kube-prometheus-stack으로 모니터링 시스템 구축하기","date":"2023-08-27 15:40","categories":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"tags":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"description":null,"keywords":"devops","cover":null},"fields":{"slug":"/kube-prometheus-stack","date":"2023-08-27T06:40:00.000Z"}}},"pageContext":{"slug":"/kube-prometheus-stack","nexttitle":"좌충우돌 AWS EKS Nodegroup 전환기","nextslug":"/aws-eks-ng","prevtitle":"KUBERNETES에서 POD가 생성되고 업데이트 되는 과정","prevslug":"/kubernetes-apply-pod","tagList":["Devops","kubernetes","k8s","Certification","Pod","review","Kubernetes","promehtues","loki","grafana","Observability","AWS","AWS EKS","AWS EC2","AWS OpenSearch","EFKStack","EC2","ArgoCD","Slack","metric","K8s","Storage","EKS","Linux","Ubuntu","Gitlab","Jenkins","config","terminal","iterms","git","github","develop","Java","Spring","cron","React.js","Redux.js","Javascript","DB","DataBase","MySQL","vue","spring","mysql","jsp","db"],"categoryList":["Devops","kubernetes","k8s","Certification","Pod","review","Kubernetes","promehtues","loki","grafana","Observability","AWS","AWS EKS","AWS EC2","EFKStack","EC2","ArgoCD","Slack","metric","Storage","Linux","Ubuntu","config","git","Java","React.js","DataBase","develop"],"latestPostEdges":[{"node":{"fields":{"slug":"/blog"},"frontmatter":{"template":"post","title":"Blog 이사갔습니다!!! ","tags":null,"categories":null,"date":"2024-10-20 00:30"}}},{"node":{"fields":{"slug":"/cka-ckad-review"},"frontmatter":{"template":"post","title":"CKA, CKAD 취득 후기","tags":["Devops","kubernetes","k8s","Certification"],"categories":["Devops","kubernetes","k8s","Certification"],"date":"2024-02-23 17:20"}}},{"node":{"fields":{"slug":"/k8s-pod-lifecycle"},"frontmatter":{"template":"post","title":"쿠버네티스에서 Pod의 생애주기","tags":["Devops","kubernetes","k8s","Pod"],"categories":["Devops","kubernetes","k8s","Pod"],"date":"2024-01-03 13:50"}}},{"node":{"fields":{"slug":"/2023-review"},"frontmatter":{"template":"post","title":"2023년 회고","tags":["Devops","review"],"categories":["Devops","review"],"date":"2023-12-30 13:00"}}}]}},"staticQueryHashes":[]}