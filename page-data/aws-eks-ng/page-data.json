{"componentChunkName":"component---src-templates-post-template-jsx","path":"/aws-eks-ng","result":{"data":{"markdownRemark":{"html":"<h1 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h1>\n<p>현재 AWS EKS를 이용하여 K8s 를 구축하고 운영하고 있습니다. 하지만 최근들어 신규 서비스도 런칭하고, 배포해야 할 Pod 수도 늘어나고, 여러 가지 devops 관련 pod를 구축하고 싶어 프로젝트로 일정을 수립하고 진행하고 있던 와중 Pod가 정상적으로 생성되지 않는 현상이 발생했습니다..!</p>\n<p>찾아보니 EKS Workernode로 사용중인 EC2 Instance 의 Memory 의 용량이 부족하여 Pod를 띄울 수 없었습니다.</p>\n<h1 id=\"적절한-ec2-instance-type을-찾아보자\" style=\"position:relative;\"><a href=\"#%EC%A0%81%EC%A0%88%ED%95%9C-ec2-instance-type%EC%9D%84-%EC%B0%BE%EC%95%84%EB%B3%B4%EC%9E%90\" aria-label=\"적절한 ec2 instance type을 찾아보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>적절한 EC2 Instance Type을 찾아보자!</h1>\n<p>제가 처음 고려했던 Type은 현재쓰고 있는 다음 크기의 EC2 였습니다.</p>\n<ul>\n<li>As-Is :  t3.xlarge</li>\n<li>To-Be : t3.2xlarge</li>\n</ul>\n<p><strong>타입 비교</strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>vCPU*</th>\n<th>메모리(GiB)</th>\n<th>네트워크 성능(Gbps)***</th>\n<th>최대 Pod수</th>\n<th>시간당 요금</th>\n<th>한달 요금</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>t3.xlarge</td>\n<td>4</td>\n<td>16</td>\n<td>최대 5</td>\n<td>58</td>\n<td>0.208 USD</td>\n<td>200,524.46원</td>\n</tr>\n<tr>\n<td>t3.2xlarge</td>\n<td>8</td>\n<td>32</td>\n<td>최대 5</td>\n<td>58</td>\n<td>0.416USD</td>\n<td>401,048.92원</td>\n</tr>\n</tbody>\n</table>\n<p>하지만,, 회사 입장에서 비용이 과하다는 피드백이 돌아왔고 눈물을 머금고 다른 type을 찾기 시작했습니다.</p>\n<p>같은 CPU, Memory를 호스팅 해주는 것을 중점으로 찾다가 t4g type을 찾게 되었습니다..! </p>\n<p><strong>타입 비교</strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>vCPU*</th>\n<th>메모리(GiB)</th>\n<th>최대 Pod수</th>\n<th>시간당 요금</th>\n<th>한달 요금</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>t3.xlarge</td>\n<td>4</td>\n<td>16</td>\n<td>58</td>\n<td>0.208 USD</td>\n<td>200,524.46원</td>\n</tr>\n<tr>\n<td>t3.2xlarge</td>\n<td>8</td>\n<td>32</td>\n<td>58</td>\n<td>0.416USD</td>\n<td>401,048.92원</td>\n</tr>\n<tr>\n<td>t4g.2xlarge</td>\n<td>8</td>\n<td>32</td>\n<td>58</td>\n<td>0.3328USD</td>\n<td>320,833.85원</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"하지만\" style=\"position:relative;\"><a href=\"#%ED%95%98%EC%A7%80%EB%A7%8C\" aria-label=\"하지만 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하지만..!</h1>\n<p>그렇게 t4g type으로 결정하고 AWS EKS에서 새로운 node group을 생성하는 도중 AMI 이미지가 다른 것을 확인하게 되었습니다. t3는 <code class=\"language-text\">AL2_x86_64</code> 인 반면 t4g는 <code class=\"language-text\">AL2_ARM_64</code>였습니다. </p>\n<p>별 문제 없겠거니.. 싶었지만 그래도 조사를 해보았고 gpt는 아래와 같은 답변을 주었습니다.</p>\n<h2 id=\"t3-vs-t4g\" style=\"position:relative;\"><a href=\"#t3-vs-t4g\" aria-label=\"t3 vs t4g permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>t3 vs t4g</h2>\n<blockquote>\n<p><strong>[GPT]</strong></p>\n<h4 id=\"t3-모델\" style=\"position:relative;\"><a href=\"#t3-%EB%AA%A8%EB%8D%B8\" aria-label=\"t3 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>T3 모델</h4>\n<ul>\n<li>T3 인스턴스 패밀리는 \"burstable\" 워크로드를 위해 최적화되었습니다. 이는 CPU 사용률이 낮고 가끔 높은 CPU 활동이 필요한 경우에 해당합니다.</li>\n<li>예를 들어, 워크로드가 일반적으로 낮은 CPU 부하를 가지며 가끔 특정 시점에서 높은 CPU 부하를 겪는 경우, T3 인스턴스 패밀리는 이러한 워크로드에 적합하며 비용 효율적일 수 있습니다.</li>\n<li>T3a 인스턴스와 달리, T3 인스턴스는 Skylake 프로세서를 사용합니다.</li>\n</ul>\n<p>→ 가변적인 CPU 사용량을 가진 워크로드에 유용하</p>\n<h4 id=\"t4g-모델\" style=\"position:relative;\"><a href=\"#t4g-%EB%AA%A8%EB%8D%B8\" aria-label=\"t4g 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>T4g 모델</h4>\n<ul>\n<li>T4g 인스턴스 패밀리는 ARM 기반의 AWS Graviton2 프로세서를 사용하여 동작합니다.</li>\n<li>T4g 인스턴스는 가격 대비 성능을 개선하도록 설계되었습니다.</li>\n<li>ARM 프로세서의 사용으로 인해 T4g 인스턴스는 일부 워크로드에서 좋은 성능을 발휘할 수 있습니다.</li>\n</ul>\n<p>→ ARM 기반 프로세서를 사용하여 특정 워크로드에서 성능을 향상</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token constant\">AL2_ARM_64</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">ARM</span> <span class=\"token number\">64</span>비트 아키텍처<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n<span class=\"token operator\">-</span> <span class=\"token constant\">AL2_ARM_64</span>는 <span class=\"token constant\">ARM</span> <span class=\"token number\">64</span>비트 아키텍처를 기반으로 동작하는 Amazon Linux <span class=\"token number\">2</span> 인스턴스 유형입니다<span class=\"token punctuation\">.</span>\n<span class=\"token operator\">-</span> <span class=\"token constant\">ARM</span> 아키텍처는 저전력 및 효율적인 프로세서 아키텍처로<span class=\"token punctuation\">,</span> 모바일 및 임베디드 시스템에서 주로 사용됩니다<span class=\"token punctuation\">.</span>\n<span class=\"token operator\">-</span> <span class=\"token constant\">AL2_ARM_64</span> 인스턴스 유형은 <span class=\"token constant\">ARM</span> 프로세서를 사용하여 실행되며<span class=\"token punctuation\">,</span> 컴퓨팅 및 메모리 요구 사항을 처리하는 데 최적화되어 있습니다<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token function\">AL2_x86_64</span> <span class=\"token punctuation\">(</span>x86 <span class=\"token number\">64</span>비트 아키텍처<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n<span class=\"token operator\">-</span> AL2_x86_64는 x86 <span class=\"token number\">64</span>비트 아키텍처를 기반으로 동작하는 Amazon Linux <span class=\"token number\">2</span> 인스턴스 유형입니다<span class=\"token punctuation\">.</span>\n<span class=\"token operator\">-</span> x86 아키텍처는 주류 컴퓨터 시스템에서 많이 사용되며<span class=\"token punctuation\">,</span> Intel 및 <span class=\"token constant\">AMD</span> 프로세서를 포함한 다양한 프로세서에서 실행됩니다<span class=\"token punctuation\">.</span>\n<span class=\"token operator\">-</span> AL2_x86_64 인스턴스 유형은 x86 <span class=\"token number\">64</span>비트 아키텍처를 사용하여 실행되며<span class=\"token punctuation\">,</span> 다양한 워크로드 및 응용 프로그램을 처리하는 데 최적화되어 있습니다<span class=\"token punctuation\">.</span></code></pre></div>\n<p>아키텍처가 다르다보니 여러 이슈가 생길 것 같았지만 무슨 문제가 있을까 궁금했습니다. 그래서 일단 해당 node에만 파드를 하나 생성해서 테스트 해보자 생각으로 구성을 이어갔습니다.</p>\n<p>해당 node에 label을 주었고, test pod manifast file에 labelSelector를 이용하여 해당 노드에만 Pod가 띄어지게 구성하였고 바로 배포해보았습니다.</p>\n<p>하지만 아니나 다를까 Pod가 생성되지 않고 <code class=\"language-text\">CrashBackOff</code>로 계속 restart가 되고 있었습니다..</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.666666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARElEQVQI1yXIQQ6AIAxE0W40hQimtBQj4f7HHBtZvPzJkAljWAoZ661QSXBlPD3/n7cT4yZMJXi0XZuWXQkWu1cCH4QPoGIXIbXZ9MUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pod-error\"\n        title=\"pod-error\"\n        src=\"/static/71142325f4aea3dc544023a12cd0f477/7c811/pod-error.png\"\n        srcset=\"/static/71142325f4aea3dc544023a12cd0f477/103f2/pod-error.png 165w,\n/static/71142325f4aea3dc544023a12cd0f477/748ba/pod-error.png 330w,\n/static/71142325f4aea3dc544023a12cd0f477/7c811/pod-error.png 660w,\n/static/71142325f4aea3dc544023a12cd0f477/d28e0/pod-error.png 990w,\n/static/71142325f4aea3dc544023a12cd0f477/99dcf/pod-error.png 1118w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>띠용?!! <code class=\"language-text\">exec format error</code>?! </p>\n<p>해당 오류는 처음 보는 내용이었고 바로 구글링을 해봤습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.272727272727277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQY042P2RLDIAhF/f+/7JpoTF2zuIWCJmmfOmXmjIjIvbCcM6SUwHt/Ms8zTNMEHlmWpdaccxV6I7TWoBBjLFhroWwbUDCtDRYcjOMInPMPQpynEAP0mD+7Dvqe11wptQs3gSPYIGV9NKjywpOcfUMuJ/zQ3Lc75SFE2NAVQVtG3JJyFmKsK8eYavHfuN2vcOkkPKRBMyQQmkMalEs5Gw/VXxTstxYHOXS/rru7NuMNRq+ETcvl9CcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stackoverflow\"\n        title=\"stackoverflow\"\n        src=\"/static/acac002c761c7b1769d8160df70b5dae/7c811/stackoverflow.png\"\n        srcset=\"/static/acac002c761c7b1769d8160df70b5dae/103f2/stackoverflow.png 165w,\n/static/acac002c761c7b1769d8160df70b5dae/748ba/stackoverflow.png 330w,\n/static/acac002c761c7b1769d8160df70b5dae/7c811/stackoverflow.png 660w,\n/static/acac002c761c7b1769d8160df70b5dae/d28e0/stackoverflow.png 990w,\n/static/acac002c761c7b1769d8160df70b5dae/bb51b/stackoverflow.png 1320w,\n/static/acac002c761c7b1769d8160df70b5dae/e432b/stackoverflow.png 1502w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><code class=\"language-text\">x86</code>으로 build된 Docker Image는 <code class=\"language-text\">arm64/aarch64</code> 아키텍처 서버에서는 띄울 수 없다… 는 내용의 답변이었고 <a href=\"https://docs.docker.com/build/building/multi-platform/\">Docker</a> 공식 페이지를 들어가서 확인해보니 특정 옵션을 주어서 Docker Image build를 하면 된다 라는 문서를 확인하게 되었습니다.</p>\n<p>하지만 이미 서비스중인 파드들이 많고 이미지 빌드 형식을 바꾸기엔 공수가 많이 드는 작업이었고, 추후 서비스가 더 늘어날 시에 <code class=\"language-text\">x86</code> 아키텍처의 EC2를 사용할 가능성이 다분하여 다른 대안을 모색하게 되었습니다.  </p>\n<h1 id=\"대안\" style=\"position:relative;\"><a href=\"#%EB%8C%80%EC%95%88\" aria-label=\"대안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>대안</h1>\n<p>현재 운영중인 모든 서비스가 띄어져 있는 기존 node의 memory를 늘려 더 많은 pod를 띄우려는 것이 목적이었던터라 <strong>같은 아키텍처의 EC2 instance</strong>가 전제였습니다.</p>\n<p>그래서 결국 다른 EC2 instance type을 찾아보게 되었고 <code class=\"language-text\">t3a</code>를 찾았습니다..!</p>\n<h3 id=\"t3a-모델\" style=\"position:relative;\"><a href=\"#t3a-%EB%AA%A8%EB%8D%B8\" aria-label=\"t3a 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>t3a 모델</h3>\n<blockquote>\n<p><strong>[GPT]</strong></p>\n<h4 id=\"t3a-모델-1\" style=\"position:relative;\"><a href=\"#t3a-%EB%AA%A8%EB%8D%B8-1\" aria-label=\"t3a 모델 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>T3a 모델</h4>\n<ul>\n<li>T3a 인스턴스 패밀리는 T3와 유사한 특성을 가지고 있습니다. 하지만 프로세서가 다릅니다. T3a는 AMD EPYC 7000 시리즈 프로세서를 사용합니다.</li>\n<li>T3a 모델은 비슷한 워크로드에 대해 T3와 비슷한 성능을 제공하지만, 프로세서에 따른 차이가 있습니다.</li>\n</ul>\n</blockquote>\n<h3 id=\"타입-정리\" style=\"position:relative;\"><a href=\"#%ED%83%80%EC%9E%85-%EC%A0%95%EB%A6%AC\" aria-label=\"타입 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>타입 정리</h3>\n<table>\n<thead>\n<tr>\n<th>To-Be</th>\n<th>vCPU*</th>\n<th>메모리(GiB)</th>\n<th>최대 Pod수</th>\n<th>시간당 요금</th>\n<th>한달 요금</th>\n<th>최종 금액</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>t3.2xlarge</td>\n<td>8</td>\n<td>32</td>\n<td>58</td>\n<td>0.416USD</td>\n<td>304.84 USD</td>\n<td>401,048.92원</td>\n</tr>\n<tr>\n<td>t4g.2xlarge</td>\n<td>8</td>\n<td>32</td>\n<td>58</td>\n<td>0.3328 USD</td>\n<td>242.94 USD</td>\n<td>320,833.85원</td>\n</tr>\n<tr>\n<td>t3a.2xlarge</td>\n<td>8</td>\n<td>32</td>\n<td>58</td>\n<td>0.3744 USD</td>\n<td>273.31 USD</td>\n<td>360,941.39원</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"또-다른-문제\" style=\"position:relative;\"><a href=\"#%EB%98%90-%EB%8B%A4%EB%A5%B8-%EB%AC%B8%EC%A0%9C\" aria-label=\"또 다른 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>또 다른 문제..!</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 482px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.242424242424235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz42R3U7DMAyF8/4PwRvwCEhIaLsDoQkJBLsYY91oQzq6bmuaHx/ipAWtIFZLn5pY9rFPKtq2BaO7b0+jNXSgHeTPIbjJWANrbRRg+MzhvU+5buAYBDflhcTbKoNzFi6I5XmBq+sbPD49g8jHycaYUQjepqp2UKqMCRZdb95xdz/D4nX5vfloy0nERXv9FO8JfTifsNaN25CbiCgCSkLWNDjWCs1eod5m2H9uwlPoNIF+hv0V4uTWFa/nUzxMLiBXM2TzCV5uL7Erl33R/4L8RicE+8dDhUNdBqsEds95tsO2f9UPELmUGFKEHyTVNt0Lzn10yLN8ASlWuraErhRbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"eks\"\n        title=\"eks\"\n        src=\"/static/a4301d56a20956a989b8fd0079461920/b58a3/eks.png\"\n        srcset=\"/static/a4301d56a20956a989b8fd0079461920/103f2/eks.png 165w,\n/static/a4301d56a20956a989b8fd0079461920/748ba/eks.png 330w,\n/static/a4301d56a20956a989b8fd0079461920/b58a3/eks.png 482w\"\n        sizes=\"(max-width: 482px) 100vw, 482px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>t3 모델에서 t3a 모델로 바꾸면서 기존 node에 띄어져 있는 Pod들을 옮기는 drain을 진행했는데, t3a 모델의 노드 그룹 상태가 저하됨 이라고 표시되었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.81818181818182%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAj0lEQVQY04XP3Q6DIAwFYN7/JQeb+AMboIACmTmjLCHeefGlhxKawoZB4lWllJBzbkopXb7kO/SWKaWxrivO84sQIqx1CDH+hYBYq/e+5W3zDZ17vdwdRwKjJg10zrUtBynx4BxCPMG5qFlgmmZo/cY8L904TqBlKC9KtUpbMl+nXxlrm48xHfXjvt+iX/0AuAQylWzAEWkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"eks-detail\"\n        title=\"eks-detail\"\n        src=\"/static/5918f1ab35bc76737255ea7578e8730a/7c811/eks-detail.png\"\n        srcset=\"/static/5918f1ab35bc76737255ea7578e8730a/103f2/eks-detail.png 165w,\n/static/5918f1ab35bc76737255ea7578e8730a/748ba/eks-detail.png 330w,\n/static/5918f1ab35bc76737255ea7578e8730a/7c811/eks-detail.png 660w,\n/static/5918f1ab35bc76737255ea7578e8730a/d28e0/eks-detail.png 990w,\n/static/5918f1ab35bc76737255ea7578e8730a/bb51b/eks-detail.png 1320w,\n/static/5918f1ab35bc76737255ea7578e8730a/699cd/eks-detail.png 2232w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>두둥…!</p>\n<p>AWS EC2는 Instance Type별로 가용 영역이 정해져있습니다.</p>\n<ul>\n<li>\n<p>가용 영역: <code class=\"language-text\">ap-northeast-2a</code>, <code class=\"language-text\">ap-northeast-2c</code></p>\n<ul>\n<li>t2, t3a, c4 계열 등</li>\n</ul>\n</li>\n<li>\n<p>가용 영역: <code class=\"language-text\">ap-northeast-2a</code>, <code class=\"language-text\">ap-northeast-2b</code>, <code class=\"language-text\">ap-northeast-2c</code>, <code class=\"language-text\">ap-northeast-2d</code></p>\n<ul>\n<li>t3, c5 계열 등</li>\n</ul>\n</li>\n<li>\n<p>가용 영역: <code class=\"language-text\">ap-northeast-2a</code>, <code class=\"language-text\">ap-northeast-2b</code>, <code class=\"language-text\">ap-northeast-2c</code></p>\n<ul>\n<li>t3, c5 계열 등</li>\n</ul>\n</li>\n<li>\n<p>가용 영역: <code class=\"language-text\">ap-northeast-2a,</code> <code class=\"language-text\">ap-northeast-2d</code></p>\n<ul>\n<li>mac1.metal</li>\n</ul>\n</li>\n<li>\n<p>가용 영역: <code class=\"language-text\">ap-northeast-2d</code></p>\n<ul>\n<li>t3, c5 계열 등</li>\n</ul>\n</li>\n<li>\n<p>가용 영역: <code class=\"language-text\">ap-northeast-2c</code></p>\n<ul>\n<li>t2, t3, c4, c5 계열 등</li>\n</ul>\n</li>\n</ul>\n<p>또 다른 확인 방법으로는 아래의 명령어를 이용하는 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws ec2 describe-instance-type-offerings <span class=\"token punctuation\">\\</span>\n    --location-type availability-zone <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--filters</span> <span class=\"token assign-left variable\">Name</span><span class=\"token operator\">=</span>instance-type,Values<span class=\"token operator\">=</span>**t3a.*** <span class=\"token punctuation\">\\</span>\n    <span class=\"token parameter variable\">--region</span> ap-northeast-2 <span class=\"token parameter variable\">--output</span> table</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYElEQVQoz21QyU7DMBS0szux0zRrm4IQIPbtjKBpe+BOxQk4cOP//2CYOLQUwWE04/eex+MnPp+W+Hi/x8PLHKuuw3LZYdE9EvNv/h8rzv3FAiLRGlEUI1Ex4picJMjzHOPxeMs9iqIgfur97C6UUnBdl4Y8eJ4H3/cth2GILMtQliWapkFd15bbtrW6N+v7/fwGQRDwXgAhBEQch3T2fkFKCc3kaToiUpoUMMZY3deFkDvzrjX0fWcwzDLDlytMJjWm04bc2PhKhbZe1yXXoGyCfh1ax0xc2V7bTvlQwi8rrs0bDMPQg4praLMHkx4QLV8L7VmbGdLsiLzPmdx+L9EzjFgbZcfUre1FkeG6xGBoTIRxfoi8OENRXaGqz5lOo6xuWDtB1dyhKC+YZEieU1fNLWcv2T/l3DV7BQJfDobr9TPe3l75yrBURxKOA0ktqTfsOMLua1vb6TuOtLq//wVE5sQUfaQ4OQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"az\"\n        title=\"az\"\n        src=\"/static/1df755519c022936fcb2b2bd9089b542/7c811/az.png\"\n        srcset=\"/static/1df755519c022936fcb2b2bd9089b542/103f2/az.png 165w,\n/static/1df755519c022936fcb2b2bd9089b542/748ba/az.png 330w,\n/static/1df755519c022936fcb2b2bd9089b542/7c811/az.png 660w,\n/static/1df755519c022936fcb2b2bd9089b542/eb088/az.png 916w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>그렇기에 현재 작업한 Type인 t3a는 <code class=\"language-text\">ap-northeast-2a</code>, <code class=\"language-text\">ap-northeast-2c</code> 영역에서만 EC2 Instance를 생성할 수 있었지만 nodegroup을 생성할 때 <code class=\"language-text\">ap-northeast-2b</code>, <code class=\"language-text\">ap-northeast-2d</code>도 추가를 해놔서 발생한 이슈였습니다!</p>\n<p>즉, <code class=\"language-text\">ap-northeast-2b</code>, <code class=\"language-text\">ap-northeast-2d</code> 영역을 제외하고 node group을 생성해주시면 해결됩니다..!</p>\n<h1 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h1>\n<p>AWS EC2는 type별로 각각의 특성이 있습니다. 이번 작업을 통해 AWS EC2의 type별로 어떤 특성이 있는지 확인할 수 있는 값진 경험이었습니다.😂</p>\n<p>이러한 경험을 토대로 현재 운영서버는 문제없이 잘 돌아가고 있습니다 😎😎😎</p>","timeToRead":6,"excerpt":"개요 현재 AWS EKS를 이용하여 K8s 를 구축하고 운영하고 있습니다. 하지만 최근들어 신규 서비스도 런칭하고, 배포해야 할 Pod 수도 늘어나고, 여러 가지 devops 관련 pod…","frontmatter":{"title":"좌충우돌 AWS EKS Nodegroup 전환기","date":"2023-08-15 13:00","categories":["Devops","Kubernetes","AWS","AWS EKS","AWS EC2"],"tags":["Devops","Kubernetes","AWS","AWS EKS","AWS EC2"],"description":null,"keywords":"devops","cover":null},"fields":{"slug":"/aws-eks-ng","date":"2023-08-15T04:00:00.000Z"}}},"pageContext":{"slug":"/aws-eks-ng","nexttitle":"쿠버네티스 service란?!","nextslug":"/kubernetes-service","prevtitle":"kube-prometheus-stack으로 모니터링 시스템 구축하기","prevslug":"/kube-prometheus-stack","tagList":["Devops","review","Kubernetes","promehtues","loki","grafana","Observability","AWS","AWS EKS","AWS EC2","AWS OpenSearch","EFKStack","EC2","ArgoCD","Slack","metric","K8s","Storage","EKS","Linux","Ubuntu","Gitlab","Jenkins","config","terminal","iterms","git","github","develop","Java","Spring","cron","React.js","Redux.js","Javascript","DB","DataBase","MySQL","vue","spring","mysql","jsp","db"],"categoryList":["Devops","review","Kubernetes","promehtues","loki","grafana","Observability","AWS","AWS EKS","AWS EC2","EFKStack","EC2","ArgoCD","Slack","metric","Storage","Linux","Ubuntu","config","git","Java","React.js","DataBase","develop"],"latestPostEdges":[{"node":{"fields":{"slug":"/2023-review"},"frontmatter":{"template":"post","title":"2023년 회고","tags":["Devops","review"],"categories":["Devops","review"],"date":"2023-12-30 13:00"}}},{"node":{"fields":{"slug":"/kubernetes-apply-pod"},"frontmatter":{"template":"post","title":"KUBERNETES에서 POD가 생성되고 업데이트 되는 과정","tags":["Devops","Kubernetes"],"categories":["Devops","Kubernetes"],"date":"2023-09-13 10:00"}}},{"node":{"fields":{"slug":"/kube-prometheus-stack"},"frontmatter":{"template":"post","title":"kube-prometheus-stack으로 모니터링 시스템 구축하기","tags":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"categories":["Devops","Kubernetes","promehtues","loki","grafana","Observability"],"date":"2023-08-27 15:40"}}},{"node":{"fields":{"slug":"/aws-eks-ng"},"frontmatter":{"template":"post","title":"좌충우돌 AWS EKS Nodegroup 전환기","tags":["Devops","Kubernetes","AWS","AWS EKS","AWS EC2"],"categories":["Devops","Kubernetes","AWS","AWS EKS","AWS EC2"],"date":"2023-08-15 13:00"}}}]}},"staticQueryHashes":[]}